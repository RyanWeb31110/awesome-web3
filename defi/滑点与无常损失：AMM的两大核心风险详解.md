# 滑点与无常损失：AMM的两大核心风险详解

### 一、滑点（Slippage）

#### 1. **定义与原理**

滑点是指用户在 Uniswap 交易时，实际成交价格与预期价格之间的差异。

这是由于自动做市商（AMM）的恒定乘积模型（`x*y=k`）导致的：

当大额交易发生时，流动性池中的资产比例变化会显著影响兑换汇率。

#### 2. **核心公式**

- **兑换量计算**：假设用`dx`个资产 X 兑换资产 Y，兑换后池内资产变为`x+dx`和`y-dy`，满足`(x+dx)(y-dy)=k`，解得`dy ≈ (y * dx) / (x + dx)`。
- **滑点百分比**：`滑点率 = (理论应得量 - 实际获得量) / 理论应得量`。

#### 3. **数据举例**

假设流动性池初始状态：`100 ETH`和`200,000 USDC`（汇率`1 ETH = 2000 USDC`）。

用户 B 用**10 ETH**兑换 USDC（需扣除 0.3% 手续费，实际兑换`9.97 ETH`）：

- **兑换后池内 ETH**：`100 + 9.97 = 109.97 ETH`
- **新 USDC 数量**：`k = 100*200,000 = 20,000,000` → `y = 20,000,000 / 109.97 ≈ 181,820 USDC`
- **用户 B 实际获得**：`200,000 - 181,820 = 18,180 USDC`
- **理论应得量**：`10 ETH * 2000 USDC/ETH = 20,000 USDC`
- **滑点率**：`(20,000 - 18,180) / 20,000 = 9.1%`

#### 4. **关键影响因素**

- **交易规模**：交易额越大，滑点越高（如用 50 ETH 兑换会导致滑点飙升至 20% 以上）。
- **流动性深度**：池子总价值越大，滑点越低（例如 10 ETH 在 10,000 ETH 的池子中滑点不足 1%）。
- **手续费**：Uniswap V2 收取 0.3% 手续费，进一步降低实际兑换量。

#### 5. **可视化示例**

- **滑点曲线**：交易量占池子比例越大，曲线越陡峭（如交易占池子 10% 时滑点约 10%，占 20% 时滑点约 25%）。
- **对比中心化交易所**：Uniswap 的滑点显著高于订单簿模式，但提供无限流动性。

### 二、无常损失（Impermanent Loss）

#### 1. **定义与原理**

无常损失是流动性提供者（LP）因资产价格波动，导致其在流动性池中的资产组合价值低于直接持有资产的差额。

AMM 机制迫使 LP 在价格波动时被动调整资产比例，从而产生机会成本。

#### 2. **核心公式**

- **无常损失率**：`IL = 2 * sqrt(a*b)/(a+b) - 1`，其中`a`和`b`是两种资产的价格变化比率。
- **示例**：ETH 价格从 2000 USDC 涨至 3000 USDC（`a=1.5`），USDC 价格不变（`b=1`），代入公式得`IL≈5.73%`。

#### 3. **数据举例**

假设用户 A 是唯一 LP，初始存入`100 ETH`和`200,000 USDC`：

- **价格上涨后池状态**：ETH 价格 3000 USDC，池内 ETH 减少至`81.65 ETH`，USDC 增加至`244,949 USDC`。
- **LP 价值**：`81.65*3000 + 244,949 ≈ 490,899 USDC`。
- **直接持有价值**：`100*3000 + 200,000 = 500,000 USDC`。
- **无常损失**：`500,000 - 490,899 = 9,101 USDC`（即 5.73%）。

#### 4. **关键影响因素**

- **价格波动幅度**：波动越大，损失越高（如 ETH 价格翻倍时损失 5.7%，三倍时损失 13.4%）。
- **资产相关性**：稳定币对（如 USDC/DAI）损失极低（<1%），高波动币对（如 ETH/UNI）损失显著。
- **持有时间**：长期持有可能通过手续费弥补损失，但需权衡市场趋势。

#### 5. **可视化示例**

- **无常损失曲线**：价格变化比率与损失率呈非线性关系（如 ±50% 波动时损失约 5.7%，±100% 时损失约 20%）。
- **对比持币策略**：当价格回归初始水平时，无常损失消失（“无常” 得名于此）。

### 三、对比与实战策略

| **维度**     | **滑点**                     | **无常损失**                     |
| ------------ | ---------------------------- | -------------------------------- |
| **核心原因** | 交易规模超过池子流动性深度   | 资产价格波动导致池内比例失衡     |
| **影响对象** | 交易者（兑换成本增加）       | LP（组合价值低于持币）           |
| **降低方法** | 选择大池子、分批交易         | 选择低波动资产、对冲（如期权）   |
| **收益对冲** | 无直接收益，但 LP 可获手续费 | 手续费和治理代币奖励可能覆盖损失 |

#### 1. **滑点优化示例**

- **分批交易**：将 10 ETH 拆分为 5 笔 2 ETH 交易，每笔滑点从 9.1% 降至约 2%。
- **跨池路由**：通过聚合器（如 1inch）自动选择多池最优路径，降低综合滑点。

#### 2. **无常损失对冲示例**

- **期权策略**：买入 ETH 看跌期权对冲下跌风险，成本约为资产价值的 2%，可覆盖 50% 以上损失。
- **稳定币对**：提供 USDC/DAI 流动性，年波动率 < 5%，无常损失可忽略不计。

### 四、总结

- **滑点**是交易者需承担的即时成本，与交易规模正相关，需通过流动性管理优化。
- **无常损失**是 LP 的长期风险，与价格波动幅度正相关，需通过资产选择和对冲策略控制。

通过理解这两个机制，用户可在 Uniswap 生态中更精准地决策，平衡风险与收益。