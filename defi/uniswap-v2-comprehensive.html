<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Uniswap V2 æ·±åº¦è§£æ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            animation: fadeInDown 1s;
        }
        
        .header h1 {
            font-size: 48px;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 20px;
            opacity: 0.95;
        }
        
        .section {
            background: white;
            border-radius: 20px;
            padding: 35px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            animation: fadeInUp 0.8s;
        }
        
        h2 {
            color: #2c3e50;
            margin-bottom: 25px;
            padding-bottom: 12px;
            border-bottom: 3px solid #667eea;
            font-size: 28px;
        }
        
        h3 {
            color: #34495e;
            margin: 20px 0 15px 0;
            font-size: 20px;
        }
        
        /* ç‰ˆæœ¬å¯¹æ¯” */
        .version-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 30px 0;
        }
        
        .version-card {
            padding: 25px;
            border-radius: 15px;
            position: relative;
            overflow: hidden;
            transition: transform 0.3s;
        }
        
        .version-card:hover {
            transform: translateY(-5px);
        }
        
        .v1-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }
        
        .v2-card {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }
        
        .version-card h4 {
            font-size: 24px;
            margin-bottom: 15px;
        }
        
        .version-card ul {
            list-style: none;
            padding-left: 0;
        }
        
        .version-card li {
            margin: 10px 0;
            padding-left: 25px;
            position: relative;
        }
        
        .version-card li:before {
            content: "â†’";
            position: absolute;
            left: 0;
        }
        
        /* Canvaså®¹å™¨ */
        .canvas-container {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
            position: relative;
        }
        
        canvas {
            display: block;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        /* äº¤äº’æ§åˆ¶ */
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            padding: 25px;
            background: linear-gradient(135deg, #667eea15, #764ba215);
            border-radius: 15px;
            margin: 25px 0;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .control-group label {
            font-weight: 600;
            color: #2c3e50;
            font-size: 14px;
        }
        
        input[type="range"] {
            -webkit-appearance: none;
            height: 8px;
            border-radius: 5px;
            background: linear-gradient(to right, #667eea, #764ba2);
            outline: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: white;
            border: 3px solid #667eea;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }
        
        input[type="number"], select {
            padding: 12px;
            border: 2px solid #667eea;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input[type="number"]:focus, select:focus {
            border-color: #764ba2;
            outline: none;
        }
        
        button {
            padding: 14px 28px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
        }
        
        /* ä¿¡æ¯å¡ç‰‡ */
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }
        
        .info-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            transition: transform 0.3s;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        
        .info-card:hover {
            transform: scale(1.05);
        }
        
        .info-value {
            font-size: 28px;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .info-label {
            font-size: 14px;
            opacity: 0.9;
        }
        
        /* ç‰¹æ€§å¡ç‰‡ */
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }
        
        .feature-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .feature-card:hover {
            transform: translateY(-5px);
            border-color: #667eea;
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.2);
        }
        
        .feature-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            color: white;
            margin-bottom: 15px;
        }
        
        .feature-title {
            font-size: 20px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .feature-description {
            color: #7f8c8d;
            line-height: 1.6;
        }
        
        /* ä»·æ ¼é¢„è¨€æœºå±•ç¤º */
        .oracle-display {
            background: linear-gradient(135deg, #667eea20, #764ba220);
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
        }
        
        .price-history {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 20px 0;
            padding: 15px;
            background: white;
            border-radius: 10px;
        }
        
        .price-point {
            text-align: center;
        }
        
        .price-time {
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 5px;
        }
        
        .price-value {
            font-size: 18px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        /* é—ªç”µè´·æµç¨‹ */
        .flash-loan-flow {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 30px 0;
            position: relative;
        }
        
        .flow-step {
            flex: 1;
            background: white;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            position: relative;
            z-index: 2;
        }
        
        .flow-step-number {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            font-weight: bold;
        }
        
        .flow-arrow {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 100%;
            height: 2px;
            background: linear-gradient(to right, #667eea, #764ba2);
            z-index: 1;
        }
        
        /* å…¬å¼å±•ç¤º */
        .formula-box {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            font-size: 22px;
            font-family: 'Courier New', monospace;
            margin: 25px 0;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }
        
        .math-explanation {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            border-left: 4px solid #667eea;
        }
        
        .code-block {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            margin: 20px 0;
        }
        
        /* è­¦å‘Šå’Œæç¤º */
        .alert {
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .alert-warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            color: #856404;
        }
        
        .alert-info {
            background: #d1ecf1;
            border-left: 4px solid #17a2b8;
            color: #0c5460;
        }
        
        .alert-success {
            background: #d4edda;
            border-left: 4px solid #28a745;
            color: #155724;
        }
        
        /* åŠ¨ç”» */
        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 32px;
            }
            
            .version-comparison {
                grid-template-columns: 1fr;
            }
            
            .feature-grid {
                grid-template-columns: 1fr;
            }
            
            .info-grid {
                grid-template-columns: 1fr;
            }
            
            .flash-loan-flow {
                flex-direction: column;
                gap: 20px;
            }
            
            .flow-arrow {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- æ ‡é¢˜éƒ¨åˆ† -->
        <div class="header">
            <h1>ğŸ¦„ Uniswap V2 æ·±åº¦è§£æ</h1>
            <p>2020å¹´5æœˆ - DeFiåŸºç¡€è®¾æ–½çš„é©å‘½æ€§å‡çº§</p>
        </div>
        
        <!-- V1 vs V2 å¯¹æ¯” -->
        <div class="section">
            <h2>ğŸ“Š V1 åˆ° V2 çš„è¿›åŒ–</h2>
            <div class="version-comparison">
                <div class="version-card v1-card">
                    <h4>Uniswap V1 (2018)</h4>
                    <ul>
                        <li>ä»…æ”¯æŒ ETH â‡„ ERC20</li>
                        <li>ERC20äº’æ¢éœ€è¦åŒè·³</li>
                        <li>æ— ä»·æ ¼é¢„è¨€æœº</li>
                        <li>æ— é—ªç”µè´·åŠŸèƒ½</li>
                        <li>å›ºå®š0.3%æ‰‹ç»­è´¹ç»™LP</li>
                        <li>ç®€å•çš„xÂ·y=kå…¬å¼</li>
                    </ul>
                </div>
                <div class="version-card v2-card">
                    <h4>Uniswap V2 (2020)</h4>
                    <ul>
                        <li>æ”¯æŒä»»æ„ ERC20 â‡„ ERC20</li>
                        <li>ç›´æ¥äº¤æ¢ï¼ŒèŠ‚çœ50%æ‰‹ç»­è´¹</li>
                        <li>å†…ç½®TWAPä»·æ ¼é¢„è¨€æœº</li>
                        <li>åŸç”Ÿæ”¯æŒé—ªç”µè´·</li>
                        <li>å¯é€‰åè®®è´¹ç”¨ï¼ˆ0.05%ï¼‰</li>
                        <li>ä¼˜åŒ–çš„(x-Î”x)Â·(y-Î”y)=kå…¬å¼</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <!-- æ ¸å¿ƒåˆ›æ–°1ï¼šERC20-ERC20äº¤æ˜“å¯¹ -->
        <div class="section">
            <h2>ğŸ”„ æ ¸å¿ƒåˆ›æ–°1ï¼šä»»æ„ä»£å¸å¯¹äº¤æ˜“</h2>
            
            <div class="canvas-container">
                <canvas id="tradingPairsCanvas" width="900" height="400"></canvas>
            </div>
            
            <div class="controls">
                <div class="control-group">
                    <label>é€‰æ‹©äº¤æ˜“è·¯å¾„ï¼š</label>
                    <select id="tradePathSelect" onchange="updateTradePath()">
                        <option value="direct">V2ç›´æ¥äº¤æ¢ (DAIâ†’USDC)</option>
                        <option value="v1route">V1è·¯ç”± (DAIâ†’ETHâ†’USDC)</option>
                    </select>
                </div>
                <div class="control-group">
                    <label>äº¤æ˜“é‡‘é¢ (USD)ï¼š</label>
                    <input type="number" id="tradeAmountUSD" value="10000" min="100" max="1000000">
                </div>
                <div class="control-group">
                    <button onclick="simulateTrade()">æ¨¡æ‹Ÿäº¤æ˜“</button>
                </div>
            </div>
            
            <div class="info-grid">
                <div class="info-card">
                    <div class="info-label">è·¯å¾„æ­¥æ•°</div>
                    <div class="info-value" id="pathSteps">1</div>
                </div>
                <div class="info-card">
                    <div class="info-label">æ€»æ‰‹ç»­è´¹</div>
                    <div class="info-value" id="totalFee">0.30%</div>
                </div>
                <div class="info-card">
                    <div class="info-label">è´¹ç”¨é‡‘é¢</div>
                    <div class="info-value" id="feeAmount">$30</div>
                </div>
                <div class="info-card">
                    <div class="info-label">èŠ‚çœè´¹ç”¨</div>
                    <div class="info-value" id="savedAmount">$30</div>
                </div>
            </div>
            
            <div class="alert alert-success">
                <strong>ğŸ’¡ å…³é”®æ”¹è¿›ï¼š</strong> V2å…è®¸ç›´æ¥åˆ›å»ºä»»æ„ERC20ä»£å¸å¯¹ï¼Œæ— éœ€ETHä½œä¸ºä¸­ä»‹ã€‚è¿™å°†äº¤æ˜“æˆæœ¬é™ä½50%ï¼Œå¹¶æé«˜äº†èµ„æœ¬æ•ˆç‡ã€‚
            </div>
        </div>
        
        <!-- æ ¸å¿ƒåˆ›æ–°2ï¼šä»·æ ¼é¢„è¨€æœº -->
        <div class="section">
            <h2>ğŸ”® æ ¸å¿ƒåˆ›æ–°2ï¼šæ—¶é—´åŠ æƒå¹³å‡ä»·æ ¼ï¼ˆTWAPï¼‰é¢„è¨€æœº</h2>
            
            <div class="formula-box">
                TWAP = Î£(ä»·æ ¼áµ¢ Ã— æ—¶é—´áµ¢) / Î£æ—¶é—´áµ¢
            </div>
            
            <div class="canvas-container">
                <canvas id="oracleCanvas" width="900" height="400"></canvas>
            </div>
            
            <div class="controls">
                <div class="control-group">
                    <label>ä»·æ ¼æ“çºµå°è¯•ï¼ˆ%ï¼‰ï¼š<span id="manipulationValue">0</span></label>
                    <input type="range" id="manipulationSlider" min="-50" max="50" value="0" step="5">
                </div>
                <div class="control-group">
                    <label>è§‚å¯Ÿæ—¶é—´çª—å£ï¼ˆåŒºå—ï¼‰ï¼š</label>
                    <input type="number" id="timeWindow" value="10" min="1" max="100">
                </div>
                <div class="control-group">
                    <button onclick="simulateManipulation()">æ¨¡æ‹Ÿä»·æ ¼æ“çºµ</button>
                </div>
            </div>
            
            <div class="oracle-display">
                <h3>ä»·æ ¼å†å²è®°å½•</h3>
                <div class="price-history">
                    <div class="price-point">
                        <div class="price-time">åŒºå— -10</div>
                        <div class="price-value">$2000</div>
                    </div>
                    <div class="price-point">
                        <div class="price-time">åŒºå— -5</div>
                        <div class="price-value">$2010</div>
                    </div>
                    <div class="price-point">
                        <div class="price-time">å½“å‰åŒºå—</div>
                        <div class="price-value" id="currentPrice">$2000</div>
                    </div>
                    <div class="price-point">
                        <div class="price-time">TWAP</div>
                        <div class="price-value" id="twapPrice" style="color: #27ae60;">$2003</div>
                    </div>
                </div>
            </div>
            
            <div class="math-explanation">
                <h3>TWAP é˜²æ“çºµæœºåˆ¶ï¼š</h3>
                <p><strong>ç´¯ç§¯ä»·æ ¼å­˜å‚¨ï¼š</strong> price0CumulativeLast += price0 * timeElapsed</p>
                <p><strong>å¹³å‡ä»·æ ¼è®¡ç®—ï¼š</strong> TWAP = (cumulative_now - cumulative_then) / time_elapsed</p>
                <p><strong>é˜²æŠ¤æ•ˆæœï¼š</strong> å•ä¸ªåŒºå—çš„ä»·æ ¼æ“çºµå¯¹é•¿æ—¶é—´çª—å£çš„TWAPå½±å“æå°</p>
            </div>
        </div>
        
        <!-- æ ¸å¿ƒåˆ›æ–°3ï¼šé—ªç”µè´· -->
        <div class="section">
            <h2>âš¡ æ ¸å¿ƒåˆ›æ–°3ï¼šåŸç”Ÿé—ªç”µè´·ï¼ˆFlash Swapsï¼‰</h2>
            
            <div class="flash-loan-flow">
                <div class="flow-arrow"></div>
                <div class="flow-step">
                    <div class="flow-step-number">1</div>
                    <strong>å€Ÿå‡ºèµ„äº§</strong>
                    <p>ä»æ± ä¸­å€Ÿå‡ºä»£å¸</p>
                    <p style="color: #667eea;">æ— éœ€æŠµæŠ¼</p>
                </div>
                <div class="flow-step">
                    <div class="flow-step-number">2</div>
                    <strong>æ‰§è¡Œæ“ä½œ</strong>
                    <p>å¥—åˆ©/æ¸…ç®—/å†èèµ„</p>
                    <p style="color: #667eea;">ä»»æ„DeFiæ“ä½œ</p>
                </div>
                <div class="flow-step">
                    <div class="flow-step-number">3</div>
                    <strong>å½’è¿˜+è´¹ç”¨</strong>
                    <p>å½’è¿˜æœ¬é‡‘+0.3%</p>
                    <p style="color: #667eea;">åŒä¸€äº¤æ˜“å†…</p>
                </div>
            </div>
            
            <div class="code-block">
// Uniswap V2 é—ªç”µè´·ç¤ºä¾‹ä»£ç 
function uniswapV2Call(address sender, uint amount0, uint amount1, bytes data) {
    // 1. æ¥æ”¶å€Ÿå‡ºçš„ä»£å¸
    uint amountBorrowed = amount0 > 0 ? amount0 : amount1;
    
    // 2. æ‰§è¡Œå¥—åˆ©é€»è¾‘
    executeArbitrage(amountBorrowed);
    
    // 3. è®¡ç®—éœ€è¦å½’è¿˜çš„é‡‘é¢ï¼ˆå«0.3%æ‰‹ç»­è´¹ï¼‰
    uint amountToRepay = (amountBorrowed * 1003) / 1000;
    
    // 4. å½’è¿˜ä»£å¸ç»™æ± å­
    IERC20(token).transfer(msg.sender, amountToRepay);
}</div>
            
            <div class="canvas-container">
                <canvas id="flashLoanCanvas" width="900" height="350"></canvas>
            </div>
            
            <div class="controls">
                <div class="control-group">
                    <label>å€Ÿè´·é‡‘é¢ (ETH)ï¼š</label>
                    <input type="number" id="loanAmount" value="100" min="1" max="10000">
                </div>
                <div class="control-group">
                    <label>å¥—åˆ©åˆ©æ¶¦ç‡ (%)ï¼š</label>
                    <input type="number" id="profitRate" value="0.5" min="0" max="5" step="0.1">
                </div>
                <div class="control-group">
                    <button onclick="calculateFlashLoan()">è®¡ç®—æ”¶ç›Š</button>
                </div>
            </div>
            
            <div class="info-grid">
                <div class="info-card">
                    <div class="info-label">å€Ÿè´·é‡‘é¢</div>
                    <div class="info-value" id="borrowAmount">100 ETH</div>
                </div>
                <div class="info-card">
                    <div class="info-label">é—ªç”µè´·è´¹ç”¨</div>
                    <div class="info-value" id="flashFee">0.3 ETH</div>
                </div>
                <div class="info-card">
                    <div class="info-label">å¥—åˆ©æ”¶ç›Š</div>
                    <div class="info-value" id="arbProfit">0.5 ETH</div>
                </div>
                <div class="info-card">
                    <div class="info-label">å‡€åˆ©æ¶¦</div>
                    <div class="info-value" id="netProfit">0.2 ETH</div>
                </div>
            </div>
        </div>
        
        <!-- æ ¸å¿ƒåˆ›æ–°4ï¼šåè®®è´¹ç”¨å¼€å…³ -->
        <div class="section">
            <h2>ğŸ’° æ ¸å¿ƒåˆ›æ–°4ï¼šåè®®è´¹ç”¨æœºåˆ¶</h2>
            
            <div class="feature-grid">
                <div class="feature-card">
                    <div class="feature-icon">ğŸ’±</div>
                    <div class="feature-title">è´¹ç”¨åˆ†é…</div>
                    <div class="feature-description">
                        æ€»æ‰‹ç»­è´¹ 0.3%<br>
                        â€¢ LPè·å¾—ï¼š0.25% - 0.3%<br>
                        â€¢ åè®®è·å¾—ï¼š0% - 0.05%<br>
                        ï¼ˆå¯é€šè¿‡æ²»ç†è°ƒæ•´ï¼‰
                    </div>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">ğŸ”</div>
                    <div class="feature-title">æ²»ç†æ§åˆ¶</div>
                    <div class="feature-description">
                        åè®®è´¹ç”¨å¼€å…³ç”±æ²»ç†æ§åˆ¶<br>
                        â€¢ é»˜è®¤å…³é—­ï¼ˆLPè·å¾—å…¨éƒ¨ï¼‰<br>
                        â€¢ å¯å¼€å¯1/6åè®®è´¹<br>
                        â€¢ ç”¨äºåè®®å‘å±•
                    </div>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">ğŸ“Š</div>
                    <div class="feature-title">æ”¶ç›Šæ¨¡å‹</div>
                    <div class="feature-description">
                        ä¸ºUNIä»£å¸åˆ›é€ ä»·å€¼<br>
                        â€¢ åè®®æ”¶å…¥æ¥æº<br>
                        â€¢ å¯æŒç»­å‘å±•åŸºé‡‘<br>
                        â€¢ æ¿€åŠ±ç”Ÿæ€å»ºè®¾
                    </div>
                </div>
            </div>
            
            <div class="canvas-container">
                <canvas id="feeDistributionCanvas" width="900" height="300"></canvas>
            </div>
        </div>
        
        <!-- æ•°å­¦åŸç†æ·±åº¦è§£æ -->
        <div class="section">
            <h2>ğŸ“ V2 æ•°å­¦åŸç†æ·±åº¦è§£æ</h2>
            
            <h3>1. æ”¹è¿›çš„æ’å®šä¹˜ç§¯å…¬å¼</h3>
            <div class="formula-box">
                (x - 0.003Â·Î”x) Â· (y - Î”y) = x Â· y
            </div>
            
            <div class="math-explanation">
                <h4>å…¬å¼æ¨å¯¼ï¼š</h4>
                <p><strong>è¾“å…¥å«æ‰‹ç»­è´¹ï¼š</strong> actual_input = input Ã— 0.997</p>
                <p><strong>è¾“å‡ºè®¡ç®—ï¼š</strong> output = (actual_input Ã— reserve_out) / (reserve_in + actual_input)</p>
                <p><strong>ä»·æ ¼å½±å“ï¼š</strong> price_impact = (2 Ã— actual_input) / (reserve_in + actual_input)</p>
                
                <h4>å…³é”®æ”¹è¿›ï¼š</h4>
                <ul style="margin-top: 15px; padding-left: 25px;">
                    <li>æ‰‹ç»­è´¹åœ¨äº¤æ˜“å‰æ‰£é™¤ï¼Œæé«˜äº†è®¡ç®—ç²¾åº¦</li>
                    <li>ä½¿ç”¨æ•´æ•°è¿ç®—é¿å…ç²¾åº¦æŸå¤±</li>
                    <li>ä¼˜åŒ–çš„å¹³æ–¹æ ¹è®¡ç®—ï¼ˆbabylonian methodï¼‰</li>
                </ul>
            </div>
            
            <div class="canvas-container">
                <canvas id="mathCanvas" width="900" height="400"></canvas>
            </div>
        </div>
        
        <!-- å®‰å…¨æ€§æ”¹è¿› -->
        <div class="section">
            <h2>ğŸ”’ å®‰å…¨æ€§ä¸ä¼˜åŒ–</h2>
            
            <div class="feature-grid">
                <div class="feature-card">
                    <div class="feature-icon">ğŸ›¡ï¸</div>
                    <div class="feature-title">é‡å…¥æ”»å‡»é˜²æŠ¤</div>
                    <div class="feature-description">
                        ä½¿ç”¨äº’æ–¥é”ï¼ˆMutexï¼‰é˜²æ­¢é‡å…¥<br>
                        â€¢ lock modifierä¿æŠ¤<br>
                        â€¢ çŠ¶æ€æ£€æŸ¥ä¼˜å…ˆ<br>
                        â€¢ ä¸¥æ ¼çš„è°ƒç”¨é¡ºåº
                    </div>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">âš™ï¸</div>
                    <div class="feature-title">Gasä¼˜åŒ–</div>
                    <div class="feature-description">
                        ç›¸æ¯”V1å‡å°‘çº¦30% gasæ¶ˆè€—<br>
                        â€¢ ä¼˜åŒ–çš„å­˜å‚¨å¸ƒå±€<br>
                        â€¢ æ‰¹é‡æ“ä½œæ”¯æŒ<br>
                        â€¢ ç¼“å­˜æœºåˆ¶
                    </div>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">ğŸ”</div>
                    <div class="feature-title">ä»·æ ¼æ“çºµé˜²æŠ¤</div>
                    <div class="feature-description">
                        TWAPæœºåˆ¶é˜²æ­¢ç¬æ—¶æ“çºµ<br>
                        â€¢ ç´¯ç§¯ä»·æ ¼å­˜å‚¨<br>
                        â€¢ æ—¶é—´åŠ æƒå¹³å‡<br>
                        â€¢ æœ€å°æµåŠ¨æ€§é”å®š
                    </div>
                </div>
            </div>
            
            <div class="code-block">
// V2 å®‰å…¨æœºåˆ¶ç¤ºä¾‹
contract UniswapV2Pair {
    uint private unlocked = 1;
    
    modifier lock() {
        require(unlocked == 1, 'LOCKED');
        unlocked = 0;
        _;
        unlocked = 1;
    }
    
    function swap(uint amount0Out, uint amount1Out, address to) external lock {
        // 1. éªŒè¯è¾“å‡ºé‡‘é¢
        require(amount0Out > 0 || amount1Out > 0, 'INSUFFICIENT_OUTPUT');
        
        // 2. è·å–å‚¨å¤‡é‡
        (uint112 _reserve0, uint112 _reserve1,) = getReserves();
        
        // 3. éªŒè¯æµåŠ¨æ€§
        require(amount0Out < _reserve0 && amount1Out < _reserve1, 'INSUFFICIENT_LIQUIDITY');
        
        // 4. è½¬è´¦
        if (amount0Out > 0) _safeTransfer(token0, to, amount0Out);
        if (amount1Out > 0) _safeTransfer(token1, to, amount1Out);
        
        // 5. æ›´æ–°å‚¨å¤‡
        _update(balance0, balance1, _reserve0, _reserve1);
        
        // 6. éªŒè¯Kå€¼
        require(balance0Adjusted * balance1Adjusted >= uint(_reserve0) * _reserve1, 'K');
    }
}</div>
        </div>
        
        <!-- å®é™…åº”ç”¨æ¡ˆä¾‹ -->
        <div class="section">
            <h2>ğŸ’¼ V2 å®é™…åº”ç”¨æ¡ˆä¾‹</h2>
            
            <h3>æ¡ˆä¾‹1ï¼šç¨³å®šå¸äº¤æ¢ä¼˜åŒ–</h3>
            <div class="alert alert-info">
                <strong>åœºæ™¯ï¼š</strong> ç”¨æˆ·æƒ³è¦å°† 100,000 DAI æ¢æˆ USDC<br>
                <strong>V1è·¯å¾„ï¼š</strong> DAI â†’ ETH â†’ USDC (0.6% è´¹ç”¨ = $600)<br>
                <strong>V2è·¯å¾„ï¼š</strong> DAI â†’ USDC (0.3% è´¹ç”¨ = $300)<br>
                <strong>èŠ‚çœï¼š</strong> $300 (50%è´¹ç”¨å‡å°‘)
            </div>
            
            <h3>æ¡ˆä¾‹2ï¼šé—ªç”µè´·å¥—åˆ©</h3>
            <div class="alert alert-info">
                <strong>æœºä¼šå‘ç°ï¼š</strong> ETHåœ¨Uniswapä»·æ ¼$2000ï¼Œåœ¨å…¶ä»–DEXä»·æ ¼$2020<br>
                <strong>æ“ä½œæµç¨‹ï¼š</strong><br>
                1. ä»Uniswapé—ªç”µè´·100 ETH<br>
                2. åœ¨å…¶ä»–DEXå–å‡ºè·å¾—202,000 USDC<br>
                3. åœ¨Uniswapä¹°å›100.3 ETHï¼ˆå«è´¹ç”¨ï¼‰èŠ±è´¹201,000 USDC<br>
                4. å½’è¿˜100.3 ETHç»™Uniswap<br>
                <strong>å‡€åˆ©æ¶¦ï¼š</strong> 1,000 USDCï¼ˆæ— éœ€ä»»ä½•åˆå§‹èµ„é‡‘ï¼‰
            </div>
            
            <h3>æ¡ˆä¾‹3ï¼šä»·æ ¼é¢„è¨€æœºåº”ç”¨</h3>
            <div class="alert alert-info">
                <strong>å€Ÿè´·åè®®é›†æˆï¼š</strong><br>
                â€¢ Compoundä½¿ç”¨Uniswap V2 TWAPä½œä¸ºä»·æ ¼æº<br>
                â€¢ 10åˆ†é’Ÿæ—¶é—´çª—å£é˜²æ­¢æ“çºµ<br>
                â€¢ ä¸ºæ•°åäº¿ç¾å…ƒçš„å€Ÿè´·æä¾›ä»·æ ¼ä¿éšœ
            </div>
        </div>
        
        <!-- æ€§èƒ½å¯¹æ¯” -->
        <div class="section">
            <h2>ğŸ“ˆ V1 vs V2 æ€§èƒ½å¯¹æ¯”</h2>
            
            <div class="canvas-container">
                <canvas id="performanceCanvas" width="900" height="400"></canvas>
            </div>
            
            <div class="info-grid">
                <div class="info-card">
                    <div class="info-label">GasèŠ‚çœ</div>
                    <div class="info-value">~30%</div>
                </div>
                <div class="info-card">
                    <div class="info-label">æ”¯æŒçš„äº¤æ˜“å¯¹</div>
                    <div class="info-value">âˆ</div>
                </div>
                <div class="info-card">
                    <div class="info-label">æ—¥äº¤æ˜“é‡å¢é•¿</div>
                    <div class="info-value">10x</div>
                </div>
                <div class="info-card">
                    <div class="info-label">TVLå³°å€¼</div>
                    <div class="info-value">$10B+</div>
                </div>
            </div>
        </div>
        
        <!-- V2çš„å½±å“å’Œæœªæ¥ -->
        <div class="section">
            <h2>ğŸŒŸ V2 çš„å†å²æ„ä¹‰ä¸å½±å“</h2>
            
            <div class="alert alert-success">
                <h3>ğŸš€ é©å‘½æ€§å½±å“ï¼š</h3>
                <ul style="margin-top: 15px; padding-left: 25px; line-height: 1.8;">
                    <li><strong>DeFiåŸºç¡€è®¾æ–½ï¼š</strong> æˆä¸ºæ•´ä¸ªDeFiç”Ÿæ€çš„ä»·æ ¼åŸºå‡†å’ŒæµåŠ¨æ€§æ¥æº</li>
                    <li><strong>å¯ç»„åˆæ€§å…¸èŒƒï¼š</strong> è¢«æ•°ç™¾ä¸ªåè®®é›†æˆï¼Œå±•ç¤ºäº†DeFiçš„ä¹é«˜ç§¯æœ¨ç‰¹æ€§</li>
                    <li><strong>åˆ›æ–°æ¿€å‘ï¼š</strong> å¯å‘äº†SushiSwapã€PancakeSwapç­‰ä¼—å¤šåˆ†å‰å’Œæ”¹è¿›</li>
                    <li><strong>é—ªç”µè´·é©å‘½ï¼š</strong> å¼€åˆ›äº†æ— æŠµæŠ¼å€Ÿè´·çš„æ–°èŒƒå¼</li>
                    <li><strong>é¢„è¨€æœºæ ‡å‡†ï¼š</strong> TWAPæˆä¸ºå»ä¸­å¿ƒåŒ–é¢„è¨€æœºçš„è¡Œä¸šæ ‡å‡†</li>
                </ul>
            </div>
            
            <div class="alert alert-warning">
                <h3>âš ï¸ V2 ä»å­˜åœ¨çš„å±€é™ï¼š</h3>
                <ul style="margin-top: 15px; padding-left: 25px; line-height: 1.8;">
                    <li><strong>èµ„æœ¬æ•ˆç‡ï¼š</strong> æµåŠ¨æ€§ä»åˆ†æ•£åœ¨0åˆ°âˆçš„ä»·æ ¼èŒƒå›´</li>
                    <li><strong>æ— å¸¸æŸå¤±ï¼š</strong> LPä»é¢ä¸´æ˜¾è‘—çš„æ— å¸¸æŸå¤±é£é™©</li>
                    <li><strong>å•ä¸€è´¹ç‡ï¼š</strong> 0.3%è´¹ç‡ä¸é€‚åˆæ‰€æœ‰äº¤æ˜“å¯¹</li>
                    <li><strong>æ»‘ç‚¹é—®é¢˜ï¼š</strong> å¤§é¢äº¤æ˜“ä»æœ‰è¾ƒé«˜æ»‘ç‚¹</li>
                    <li>â†’ è¿™äº›é—®é¢˜å°†åœ¨V3ä¸­å¾—åˆ°è§£å†³</li>
                </ul>
            </div>
        </div>
    </div>
    
    <script>
        // å…¨å±€å˜é‡
        let currentPath = 'direct';
        let manipulationLevel = 0;
        
        // åˆå§‹åŒ–æ‰€æœ‰å›¾è¡¨
        function initializeCharts() {
            drawTradingPairs();
            drawOracleVisualization();
            drawFlashLoanDiagram();
            drawFeeDistribution();
            drawMathVisualization();
            drawPerformanceComparison();
        }
        
        // 1. ç»˜åˆ¶äº¤æ˜“å¯¹è·¯å¾„å›¾
        function drawTradingPairs() {
            const canvas = document.getElementById('tradingPairsCanvas');
            const ctx = canvas.getContext('2d');
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // ç»˜åˆ¶èƒŒæ™¯
            ctx.fillStyle = '#f8f9fa';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            const centerY = canvas.height / 2;
            
            if (currentPath === 'direct') {
                // V2 ç›´æ¥è·¯å¾„
                drawToken(ctx, 150, centerY, 'DAI', '#f4b643');
                drawArrow(ctx, 250, centerY, 400, centerY, '#27ae60', 'V2: 0.3%è´¹ç”¨');
                drawToken(ctx, 500, centerY, 'USDC', '#2775ca');
                
                // æ˜¾ç¤ºèŠ‚çœ
                ctx.fillStyle = '#27ae60';
                ctx.font = 'bold 20px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('èŠ‚çœ50%æ‰‹ç»­è´¹ï¼', 450, centerY + 80);
            } else {
                // V1 è·¯ç”±è·¯å¾„
                drawToken(ctx, 100, centerY, 'DAI', '#f4b643');
                drawArrow(ctx, 180, centerY, 280, centerY - 50, '#e74c3c', '0.3%');
                drawToken(ctx, 350, centerY - 50, 'ETH', '#627eea');
                drawArrow(ctx, 420, centerY - 50, 520, centerY, '#e74c3c', '0.3%');
                drawToken(ctx, 600, centerY, 'USDC', '#2775ca');
                
                ctx.fillStyle = '#e74c3c';
                ctx.font = 'bold 18px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('æ€»è´¹ç”¨: 0.6%', 450, centerY + 80);
            }
        }
        
        // ç»˜åˆ¶ä»£å¸å›¾æ ‡
        function drawToken(ctx, x, y, symbol, color) {
            ctx.fillStyle = color;
            ctx.beginPath();
            ctx.arc(x, y, 40, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.fillStyle = 'white';
            ctx.font = 'bold 20px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(symbol, x, y);
        }
        
        // ç»˜åˆ¶ç®­å¤´
        function drawArrow(ctx, x1, y1, x2, y2, color, label) {
            ctx.strokeStyle = color;
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(x1, y1);
            ctx.lineTo(x2, y2);
            ctx.stroke();
            
            // ç®­å¤´å¤´éƒ¨
            const angle = Math.atan2(y2 - y1, x2 - x1);
            ctx.beginPath();
            ctx.moveTo(x2, y2);
            ctx.lineTo(x2 - 15 * Math.cos(angle - Math.PI/6), y2 - 15 * Math.sin(angle - Math.PI/6));
            ctx.moveTo(x2, y2);
            ctx.lineTo(x2 - 15 * Math.cos(angle + Math.PI/6), y2 - 15 * Math.sin(angle + Math.PI/6));
            ctx.stroke();
            
            // æ ‡ç­¾
            if (label) {
                ctx.fillStyle = color;
                ctx.font = '14px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(label, (x1 + x2) / 2, (y1 + y2) / 2 - 15);
            }
        }
        
        // 2. ç»˜åˆ¶é¢„è¨€æœºå¯è§†åŒ–
        function drawOracleVisualization() {
            const canvas = document.getElementById('oracleCanvas');
            const ctx = canvas.getContext('2d');
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // ç»˜åˆ¶åæ ‡ç³»
            const padding = 60;
            const width = canvas.width - 2 * padding;
            const height = canvas.height - 2 * padding;
            
            // åæ ‡è½´
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, padding + height);
            ctx.lineTo(padding + width, padding + height);
            ctx.stroke();
            
            // ç”Ÿæˆä»·æ ¼æ•°æ®
            const blocks = 50;
            const basePrice = 2000;
            const priceData = [];
            let cumulativePrice = 0;
            
            for (let i = 0; i < blocks; i++) {
                let price = basePrice + Math.sin(i * 0.2) * 20 + Math.random() * 10 - 5;
                
                // åœ¨ä¸­é—´æ·»åŠ æ“çºµå°è¯•
                if (i === Math.floor(blocks / 2)) {
                    price += price * (manipulationLevel / 100);
                }
                
                priceData.push(price);
                cumulativePrice += price;
            }
            
            const twap = cumulativePrice / blocks;
            
            // ç»˜åˆ¶å³æ—¶ä»·æ ¼çº¿
            ctx.strokeStyle = '#e74c3c';
            ctx.lineWidth = 2;
            ctx.beginPath();
            
            priceData.forEach((price, i) => {
                const x = padding + (i / blocks) * width;
                const y = padding + height - ((price - 1950) / 100) * height;
                
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });
            ctx.stroke();
            
            // ç»˜åˆ¶TWAPçº¿
            ctx.strokeStyle = '#27ae60';
            ctx.lineWidth = 3;
            ctx.setLineDash([10, 5]);
            ctx.beginPath();
            ctx.moveTo(padding, padding + height - ((twap - 1950) / 100) * height);
            ctx.lineTo(padding + width, padding + height - ((twap - 1950) / 100) * height);
            ctx.stroke();
            ctx.setLineDash([]);
            
            // æ ‡è®°æ“çºµç‚¹
            if (manipulationLevel !== 0) {
                const manipX = padding + (width / 2);
                const manipY = padding + height - ((priceData[Math.floor(blocks/2)] - 1950) / 100) * height;
                
                ctx.fillStyle = '#e74c3c';
                ctx.beginPath();
                ctx.arc(manipX, manipY, 8, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = '#e74c3c';
                ctx.font = '14px Arial';
                ctx.fillText('ä»·æ ¼æ“çºµå°è¯•', manipX + 15, manipY - 10);
            }
            
            // å›¾ä¾‹
            ctx.fillStyle = '#e74c3c';
            ctx.fillRect(padding + width - 200, padding + 20, 20, 3);
            ctx.fillStyle = '#333';
            ctx.font = '14px Arial';
            ctx.fillText('å³æ—¶ä»·æ ¼', padding + width - 170, padding + 25);
            
            ctx.fillStyle = '#27ae60';
            ctx.fillRect(padding + width - 200, padding + 45, 20, 3);
            ctx.fillText('TWAP', padding + width - 170, padding + 50);
            
            // æ›´æ–°æ˜¾ç¤º
            document.getElementById('twapPrice').textContent = '$' + twap.toFixed(0);
        }
        
        // 3. ç»˜åˆ¶é—ªç”µè´·æµç¨‹å›¾
        function drawFlashLoanDiagram() {
            const canvas = document.getElementById('flashLoanCanvas');
            const ctx = canvas.getContext('2d');
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // ç»˜åˆ¶æ—¶é—´è½´
            const centerY = canvas.height / 2;
            ctx.strokeStyle = '#667eea';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(50, centerY);
            ctx.lineTo(canvas.width - 50, centerY);
            ctx.stroke();
            
            // ç»˜åˆ¶äº¤æ˜“æ­¥éª¤
            const steps = [
                { x: 150, label: 'å¼€å§‹äº¤æ˜“', detail: 'TXå¼€å§‹' },
                { x: 350, label: 'å€Ÿå‡º100 ETH', detail: 'æ— æŠµæŠ¼' },
                { x: 550, label: 'å¥—åˆ©æ“ä½œ', detail: 'è·åˆ©' },
                { x: 750, label: 'å½’è¿˜100.3 ETH', detail: 'å«0.3%è´¹' }
            ];
            
            steps.forEach((step, index) => {
                // åœ†ç‚¹
                ctx.fillStyle = '#667eea';
                ctx.beginPath();
                ctx.arc(step.x, centerY, 10, 0, Math.PI * 2);
                ctx.fill();
                
                // æ ‡ç­¾
                ctx.fillStyle = '#2c3e50';
                ctx.font = 'bold 14px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(step.label, step.x, centerY - 30);
                
                ctx.font = '12px Arial';
                ctx.fillStyle = '#7f8c8d';
                ctx.fillText(step.detail, step.x, centerY - 50);
                
                // æ­¥éª¤ç¼–å·
                ctx.fillStyle = 'white';
                ctx.font = 'bold 12px Arial';
                ctx.fillText(index + 1, step.x, centerY + 5);
            });
            
            // å¼ºè°ƒåŸå­æ€§
            ctx.strokeStyle = '#e74c3c';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            ctx.strokeRect(100, centerY - 80, canvas.width - 200, 120);
            ctx.setLineDash([]);
            
            ctx.fillStyle = '#e74c3c';
            ctx.font = 'bold 16px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('åŸå­äº¤æ˜“ï¼šå…¨éƒ¨æˆåŠŸæˆ–å…¨éƒ¨å›æ»š', canvas.width / 2, centerY + 60);
        }
        
        // 4. ç»˜åˆ¶è´¹ç”¨åˆ†é…å›¾
        function drawFeeDistribution() {
            const canvas = document.getElementById('feeDistributionCanvas');
            const ctx = canvas.getContext('2d');
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            
            // æ€»è´¹ç”¨åœ†
            const totalRadius = 100;
            ctx.fillStyle = '#667eea';
            ctx.beginPath();
            ctx.arc(centerX - 200, centerY, totalRadius, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.fillStyle = 'white';
            ctx.font = 'bold 20px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('0.3%', centerX - 200, centerY - 10);
            ctx.fillText('æ€»è´¹ç”¨', centerX - 200, centerY + 15);
            
            // ç®­å¤´æŒ‡å‘åˆ†é…
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 3;
            
            // LPä»½é¢
            drawArrow(ctx, centerX - 100, centerY - 30, centerX + 50, centerY - 30, '#27ae60');
            ctx.fillStyle = '#27ae60';
            ctx.beginPath();
            ctx.arc(centerX + 150, centerY - 30, 60, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillStyle = 'white';
            ctx.font = 'bold 16px Arial';
            ctx.fillText('LP: 0.25%', centerX + 150, centerY - 30);
            
            // åè®®ä»½é¢ï¼ˆå¯é€‰ï¼‰
            drawArrow(ctx, centerX - 100, centerY + 30, centerX + 50, centerY + 30, '#e67e22');
            ctx.fillStyle = '#e67e22';
            ctx.beginPath();
            ctx.arc(centerX + 150, centerY + 30, 40, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillStyle = 'white';
            ctx.font = 'bold 14px Arial';
            ctx.fillText('åè®®: 0.05%', centerX + 150, centerY + 30);
            ctx.font = '12px Arial';
            ctx.fillText('(å¯é€‰)', centerX + 150, centerY + 50);
        }
        
        // 5. ç»˜åˆ¶æ•°å­¦å¯è§†åŒ–
        function drawMathVisualization() {
            const canvas = document.getElementById('mathCanvas');
            const ctx = canvas.getContext('2d');
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const padding = 60;
            const width = canvas.width - 2 * padding;
            const height = canvas.height - 2 * padding;
            
            // åæ ‡è½´
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, padding + height);
            ctx.lineTo(padding + width, padding + height);
            ctx.stroke();
            
            // V1å’ŒV2çš„Kæ›²çº¿å¯¹æ¯”
            const k = 100000;
            
            // V2æ›²çº¿ï¼ˆè€ƒè™‘æ‰‹ç»­è´¹ï¼‰
            ctx.strokeStyle = '#3498db';
            ctx.lineWidth = 3;
            ctx.beginPath();
            
            for (let x = 1; x <= 30; x += 0.5) {
                const y = k / x;
                const px = padding + (x / 30) * width;
                const py = padding + height - (y / 30000) * height;
                
                if (x === 1) {
                    ctx.moveTo(px, py);
                } else {
                    ctx.lineTo(px, py);
                }
            }
            ctx.stroke();
            
            // æ ‡ç­¾
            ctx.fillStyle = '#333';
            ctx.font = '14px Arial';
            ctx.fillText('Reserve X', padding + width - 50, padding + height + 30);
            ctx.save();
            ctx.translate(20, padding + height/2);
            ctx.rotate(-Math.PI/2);
            ctx.fillText('Reserve Y', 0, 0);
            ctx.restore();
            
            // å›¾ä¾‹
            ctx.fillStyle = '#3498db';
            ctx.font = '14px Arial';
            ctx.fillText('V2: (x - 0.003Î”x)(y - Î”y) = xy', padding + width - 250, padding + 30);
        }
        
        // 6. ç»˜åˆ¶æ€§èƒ½å¯¹æ¯”å›¾
        function drawPerformanceComparison() {
            const canvas = document.getElementById('performanceCanvas');
            const ctx = canvas.getContext('2d');
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const metrics = [
                { name: 'Gasè´¹ç”¨', v1: 100, v2: 70 },
                { name: 'äº¤æ˜“å¯¹æ•°', v1: 100, v2: 1000 },
                { name: 'æ—¥äº¤æ˜“é‡', v1: 100, v2: 1000 },
                { name: 'TVL', v1: 100, v2: 500 }
            ];
            
            const barWidth = 60;
            const barSpacing = 150;
            const maxHeight = 250;
            const startX = 100;
            const baseY = 320;
            
            metrics.forEach((metric, index) => {
                const x = startX + index * barSpacing;
                
                // V1 æŸ±çŠ¶å›¾
                const v1Height = (metric.v1 / 1000) * maxHeight;
                ctx.fillStyle = '#f093fb';
                ctx.fillRect(x, baseY - v1Height, barWidth, v1Height);
                
                // V2 æŸ±çŠ¶å›¾
                const v2Height = (metric.v2 / 1000) * maxHeight;
                ctx.fillStyle = '#4facfe';
                ctx.fillRect(x + barWidth + 10, baseY - v2Height, barWidth, v2Height);
                
                // æ•°å€¼æ ‡ç­¾
                ctx.fillStyle = '#333';
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(metric.v1, x + barWidth/2, baseY - v1Height - 10);
                ctx.fillText(metric.v2, x + barWidth + 10 + barWidth/2, baseY - v2Height - 10);
                
                // æŒ‡æ ‡åç§°
                ctx.font = '14px Arial';
                ctx.fillText(metric.name, x + barWidth + 5, baseY + 25);
            });
            
            // å›¾ä¾‹
            ctx.fillStyle = '#f093fb';
            ctx.fillRect(canvas.width - 150, 30, 20, 15);
            ctx.fillStyle = '#333';
            ctx.font = '14px Arial';
            ctx.fillText('V1', canvas.width - 120, 42);
            
            ctx.fillStyle = '#4facfe';
            ctx.fillRect(canvas.width - 150, 55, 20, 15);
            ctx.fillText('V2', canvas.width - 120, 67);
        }
        
        // äº¤äº’å‡½æ•°
        function updateTradePath() {
            const select = document.getElementById('tradePathSelect');
            currentPath = select.value;
            drawTradingPairs();
            updateTradeInfo();
        }
        
        function updateTradeInfo() {
            const amount = parseFloat(document.getElementById('tradeAmountUSD').value);
            
            if (currentPath === 'direct') {
                document.getElementById('pathSteps').textContent = '1';
                document.getElementById('totalFee').textContent = '0.30%';
                document.getElementById('feeAmount').textContent = '$' + (amount * 0.003).toFixed(2);
                document.getElementById('savedAmount').textContent = '$' + (amount * 0.003).toFixed(2);
            } else {
                document.getElementById('pathSteps').textContent = '2';
                document.getElementById('totalFee').textContent = '0.60%';
                document.getElementById('feeAmount').textContent = '$' + (amount * 0.006).toFixed(2);
                document.getElementById('savedAmount').textContent = '$0';
            }
        }
        
        function simulateTrade() {
            updateTradeInfo();
            // æ·»åŠ åŠ¨ç”»æ•ˆæœ
            const cards = document.querySelectorAll('.info-card');
            cards.forEach(card => {
                card.style.animation = 'pulse 0.5s';
                setTimeout(() => card.style.animation = '', 500);
            });
        }
        
        function simulateManipulation() {
            drawOracleVisualization();
        }
        
        function calculateFlashLoan() {
            const amount = parseFloat(document.getElementById('loanAmount').value);
            const profitRate = parseFloat(document.getElementById('profitRate').value);
            
            const fee = amount * 0.003;
            const profit = amount * (profitRate / 100);
            const netProfit = profit - fee;
            
            document.getElementById('borrowAmount').textContent = amount + ' ETH';
            document.getElementById('flashFee').textContent = fee.toFixed(3) + ' ETH';
            document.getElementById('arbProfit').textContent = profit.toFixed(3) + ' ETH';
            document.getElementById('netProfit').textContent = netProfit.toFixed(3) + ' ETH';
            
            // æ›´æ–°é¢œè‰²
            const netProfitElement = document.getElementById('netProfit');
            netProfitElement.parentElement.style.background = netProfit > 0 
                ? 'linear-gradient(135deg, #27ae60, #2ecc71)' 
                : 'linear-gradient(135deg, #e74c3c, #c0392b)';
        }
        
        // äº‹ä»¶ç›‘å¬å™¨
        document.getElementById('manipulationSlider').addEventListener('input', function(e) {
            manipulationLevel = parseFloat(e.target.value);
            document.getElementById('manipulationValue').textContent = manipulationLevel;
            drawOracleVisualization();
        });
        
        document.getElementById('tradeAmountUSD').addEventListener('input', updateTradeInfo);
        
        // åˆå§‹åŒ–
        window.addEventListener('load', function() {
            initializeCharts();
            updateTradeInfo();
            calculateFlashLoan();
        });
    </script>
</body>
</html>