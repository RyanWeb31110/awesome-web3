<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ»‘ç‚¹ä¸æ— å¸¸æŸå¤±æ·±åº¦åˆ†æ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 42px;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .section {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        h2 {
            color: #2c3e50;
            margin-bottom: 25px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
            font-size: 28px;
        }
        
        h3 {
            color: #34495e;
            margin: 20px 0 15px 0;
            font-size: 20px;
        }
        
        /* Tab Navigation */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .tab {
            padding: 12px 24px;
            background: none;
            border: none;
            font-size: 16px;
            font-weight: 600;
            color: #7f8c8d;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }
        
        .tab.active {
            color: #667eea;
        }
        
        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 3px;
            background: #667eea;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Canvas */
        .canvas-container {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
            position: relative;
        }
        
        canvas {
            display: block;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        /* Controls */
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            padding: 25px;
            background: linear-gradient(135deg, #667eea10, #764ba210);
            border-radius: 15px;
            margin: 25px 0;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .control-group label {
            font-weight: 600;
            color: #2c3e50;
            font-size: 14px;
        }
        
        .control-group span {
            color: #667eea;
            font-weight: bold;
        }
        
        input[type="range"] {
            -webkit-appearance: none;
            height: 8px;
            border-radius: 5px;
            background: #ddd;
            outline: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }
        
        input[type="number"], select {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input[type="number"]:focus, select:focus {
            border-color: #667eea;
            outline: none;
        }
        
        button {
            padding: 14px 28px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
        }
        
        /* Info Cards */
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }
        
        .info-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            transition: transform 0.3s;
        }
        
        .info-card:hover {
            transform: scale(1.05);
        }
        
        .info-value {
            font-size: 28px;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .info-label {
            font-size: 14px;
            opacity: 0.9;
        }
        
        /* Math Formulas */
        .formula-box {
            background: linear-gradient(135deg, #8e44ad, #9b59b6);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            text-align: center;
        }
        
        .math-explanation {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            border-left: 4px solid #667eea;
        }
        
        .example-box {
            background: #e8f4fd;
            border-left: 4px solid #3498db;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .warning-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .success-box {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        /* Result Display */
        .result-container {
            background: white;
            border: 2px solid #667eea;
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
        }
        
        .result-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .result-row:last-child {
            border-bottom: none;
            font-weight: bold;
            font-size: 18px;
            color: #667eea;
        }
        
        /* Comparison Table */
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        .comparison-table th {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px;
            text-align: left;
        }
        
        .comparison-table td {
            padding: 15px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .comparison-table tr:hover {
            background: #f8f9fa;
        }
        
        /* Legend */
        .legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .legend-color {
            width: 30px;
            height: 4px;
            border-radius: 2px;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 28px;
            }
            
            .tabs {
                flex-wrap: wrap;
            }
            
            .info-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“Š æ»‘ç‚¹ä¸æ— å¸¸æŸå¤±æ·±åº¦åˆ†æå·¥å…·</h1>
            <p>ç†è§£AMMçš„ä¸¤å¤§æ ¸å¿ƒé£é™©</p>
        </div>
        
        <!-- Tab Navigation -->
        <div class="section">
            <div class="tabs">
                <button class="tab active" onclick="switchTab('slippage')">æ»‘ç‚¹åˆ†æ</button>
                <button class="tab" onclick="switchTab('impermanent')">æ— å¸¸æŸå¤±</button>
                <button class="tab" onclick="switchTab('comparison')">ç»¼åˆå¯¹æ¯”</button>
                <button class="tab" onclick="switchTab('calculator')">è®¡ç®—å™¨</button>
            </div>
            
            <!-- æ»‘ç‚¹åˆ†æ Tab -->
            <div id="slippage" class="tab-content active">
                <h2>ğŸ¯ æ»‘ç‚¹ï¼ˆSlippageï¼‰è¯¦è§£</h2>
                
                <div class="formula-box">
                    æ»‘ç‚¹ = (æ‰§è¡Œä»·æ ¼ - é¢„æœŸä»·æ ¼) / é¢„æœŸä»·æ ¼ Ã— 100%
                </div>
                
                <h3>1. æ»‘ç‚¹å¯è§†åŒ–</h3>
                <div class="canvas-container">
                    <canvas id="slippageCanvas" width="900" height="400"></canvas>
                    <div class="legend">
                        <div class="legend-item">
                            <div class="legend-color" style="background: #3498db;"></div>
                            <span>ä»·æ ¼æ›²çº¿</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #e74c3c;"></div>
                            <span>å½“å‰äº¤æ˜“</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #2ecc71;"></div>
                            <span>ç°è´§ä»·æ ¼</span>
                        </div>
                    </div>
                </div>
                
                <div class="controls">
                    <div class="control-group">
                        <label>æ± å­ä¸­ ETH æ•°é‡ï¼š<span id="poolEthDisplay">1000</span></label>
                        <input type="range" id="poolEth" min="100" max="10000" value="1000" step="100">
                    </div>
                    <div class="control-group">
                        <label>æ± å­ä¸­ USDC æ•°é‡ï¼š<span id="poolUsdcDisplay">2,000,000</span></label>
                        <input type="range" id="poolUsdc" min="100000" max="10000000" value="2000000" step="100000">
                    </div>
                    <div class="control-group">
                        <label>äº¤æ˜“ ETH æ•°é‡ï¼š</label>
                        <input type="number" id="tradeAmount" value="10" min="0.1" max="500" step="0.1">
                    </div>
                    <div class="control-group">
                        <label>äº¤æ˜“ç±»å‹ï¼š</label>
                        <select id="tradeType">
                            <option value="buy">ä¹°å…¥ ETH</option>
                            <option value="sell">å–å‡º ETH</option>
                        </select>
                    </div>
                </div>
                
                <button onclick="calculateSlippage()">è®¡ç®—æ»‘ç‚¹</button>
                
                <div class="info-grid">
                    <div class="info-card">
                        <div class="info-label">ç°è´§ä»·æ ¼</div>
                        <div class="info-value" id="spotPrice">$2,000</div>
                    </div>
                    <div class="info-card">
                        <div class="info-label">æ‰§è¡Œä»·æ ¼</div>
                        <div class="info-value" id="executionPrice">$2,020</div>
                    </div>
                    <div class="info-card">
                        <div class="info-label">ä»·æ ¼æ»‘ç‚¹</div>
                        <div class="info-value" id="priceSlippage">1.00%</div>
                    </div>
                    <div class="info-card">
                        <div class="info-label">æ»‘ç‚¹æˆæœ¬</div>
                        <div class="info-value" id="slippageCost">$200</div>
                    </div>
                </div>
                
                <h3>2. æ»‘ç‚¹å½±å“å› ç´ åˆ†æ</h3>
                <div class="canvas-container">
                    <canvas id="slippageFactorsCanvas" width="900" height="350"></canvas>
                </div>
                
                <div class="math-explanation">
                    <h4>æ»‘ç‚¹è®¡ç®—å…¬å¼æ¨å¯¼ï¼š</h4>
                    <p><strong>æ’å®šä¹˜ç§¯å…¬å¼ï¼š</strong> x Â· y = k</p>
                    <p><strong>äº¤æ˜“å‰ï¼š</strong> xâ‚€ Â· yâ‚€ = k</p>
                    <p><strong>äº¤æ˜“Î”xåï¼š</strong> (xâ‚€ + Î”x) Â· (yâ‚€ - Î”y) = k</p>
                    <p><strong>æ±‚è§£Î”yï¼š</strong> Î”y = yâ‚€ Â· Î”x / (xâ‚€ + Î”x)</p>
                    <p><strong>æœ‰æ•ˆä»·æ ¼ï¼š</strong> P_effective = Î”y / Î”x = yâ‚€ / (xâ‚€ + Î”x)</p>
                    <p><strong>æ»‘ç‚¹ï¼š</strong> Slippage = (P_effective - P_spot) / P_spot = Î”x / (xâ‚€ + Î”x)</p>
                </div>
                
                <div class="example-box">
                    <h4>ğŸ“ å®ä¾‹è®¡ç®—ï¼š</h4>
                    <p>æ± å­ï¼š1000 ETH Ã— 2,000,000 USDC</p>
                    <p>ç°è´§ä»·æ ¼ï¼š2000 USDC/ETH</p>
                    <p>ä¹°å…¥ 10 ETHï¼š</p>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li>æ–°ETHæ•°é‡ï¼š1000 - 10 = 990 ETH</li>
                        <li>æ–°USDCæ•°é‡ï¼š2,000,000,000 / 990 = 2,020,202 USDC</li>
                        <li>éœ€æ”¯ä»˜ï¼š2,020,202 - 2,000,000 = 20,202 USDC</li>
                        <li>æ‰§è¡Œä»·æ ¼ï¼š20,202 / 10 = 2,020.2 USDC/ETH</li>
                        <li>æ»‘ç‚¹ï¼š(2020.2 - 2000) / 2000 = 1.01%</li>
                    </ul>
                </div>
            </div>
            
            <!-- æ— å¸¸æŸå¤± Tab -->
            <div id="impermanent" class="tab-content">
                <h2>ğŸ’” æ— å¸¸æŸå¤±ï¼ˆImpermanent Lossï¼‰è¯¦è§£</h2>
                
                <div class="formula-box">
                    IL = 2âˆš(ä»·æ ¼æ¯”ç‡) / (1 + ä»·æ ¼æ¯”ç‡) - 1
                </div>
                
                <h3>1. æ— å¸¸æŸå¤±æ›²çº¿</h3>
                <div class="canvas-container">
                    <canvas id="ilCanvas" width="900" height="400"></canvas>
                    <div class="legend">
                        <div class="legend-item">
                            <div class="legend-color" style="background: #e74c3c;"></div>
                            <span>æ— å¸¸æŸå¤±æ›²çº¿</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #3498db;"></div>
                            <span>å½“å‰æŸå¤±ç‚¹</span>
                        </div>
                    </div>
                </div>
                
                <div class="controls">
                    <div class="control-group">
                        <label>åˆå§‹ ETH ä»·æ ¼ï¼š$<span id="initPriceDisplay">2000</span></label>
                        <input type="range" id="initPrice" min="100" max="5000" value="2000" step="100">
                    </div>
                    <div class="control-group">
                        <label>å½“å‰ ETH ä»·æ ¼ï¼š$<span id="currentPriceDisplay">2000</span></label>
                        <input type="range" id="currentPrice" min="100" max="10000" value="2000" step="100">
                    </div>
                    <div class="control-group">
                        <label>åˆå§‹æŠ•èµ„ï¼ˆæ¯ç§ä»£å¸ï¼‰ï¼š</label>
                        <input type="number" id="initialInvestment" value="10000" min="100" max="1000000">
                    </div>
                    <div class="control-group">
                        <label>LPæ‰‹ç»­è´¹æ”¶ç›Šï¼ˆ%ï¼‰ï¼š</label>
                        <input type="number" id="feeEarnings" value="5" min="0" max="100" step="0.1">
                    </div>
                </div>
                
                <button onclick="calculateIL()">è®¡ç®—æ— å¸¸æŸå¤±</button>
                
                <div class="info-grid">
                    <div class="info-card">
                        <div class="info-label">ä»·æ ¼å˜åŒ–</div>
                        <div class="info-value" id="priceChange">0%</div>
                    </div>
                    <div class="info-card">
                        <div class="info-label">æ— å¸¸æŸå¤±</div>
                        <div class="info-value" id="ilPercentage">0%</div>
                    </div>
                    <div class="info-card">
                        <div class="info-label">æŸå¤±é‡‘é¢</div>
                        <div class="info-value" id="ilAmount">$0</div>
                    </div>
                    <div class="info-card">
                        <div class="info-label">å‡€æ”¶ç›Š</div>
                        <div class="info-value" id="netProfit">$0</div>
                    </div>
                </div>
                
                <h3>2. LP vs HODL å¯¹æ¯”</h3>
                <div class="canvas-container">
                    <canvas id="lpVsHodlCanvas" width="900" height="400"></canvas>
                </div>
                
                <div class="result-container">
                    <h4>è¯¦ç»†å¯¹æ¯”åˆ†æ</h4>
                    <div class="result-row">
                        <span>åˆå§‹æŠ•èµ„æ€»é¢ï¼š</span>
                        <span id="totalInvestment">$20,000</span>
                    </div>
                    <div class="result-row">
                        <span>HODLç­–ç•¥ä»·å€¼ï¼š</span>
                        <span id="hodlValue">$20,000</span>
                    </div>
                    <div class="result-row">
                        <span>LPç­–ç•¥ä»·å€¼ï¼ˆä¸å«è´¹ç”¨ï¼‰ï¼š</span>
                        <span id="lpValueNoFees">$20,000</span>
                    </div>
                    <div class="result-row">
                        <span>LPæ‰‹ç»­è´¹æ”¶ç›Šï¼š</span>
                        <span id="lpFees">$1,000</span>
                    </div>
                    <div class="result-row">
                        <span>LPç­–ç•¥æ€»ä»·å€¼ï¼š</span>
                        <span id="lpTotalValue">$21,000</span>
                    </div>
                    <div class="result-row">
                        <span>æœ€ç»ˆæŸç›Šï¼š</span>
                        <span id="finalPnL">+$1,000</span>
                    </div>
                </div>
                
                <div class="math-explanation">
                    <h4>æ— å¸¸æŸå¤±æ¨å¯¼ï¼š</h4>
                    <p><strong>è®¾å®šï¼š</strong></p>
                    <ul style="margin-left: 20px;">
                        <li>åˆå§‹ä»·æ ¼æ¯”ï¼špâ‚€ = 1</li>
                        <li>å½“å‰ä»·æ ¼æ¯”ï¼špâ‚ = r</li>
                        <li>åˆå§‹æŠ•èµ„ï¼šæ¯ç§ä»£å¸ä»·å€¼V</li>
                    </ul>
                    <p style="margin-top: 15px;"><strong>LPä»·å€¼ï¼š</strong> V_LP = 2Vâˆšr</p>
                    <p><strong>HODLä»·å€¼ï¼š</strong> V_HODL = V(1 + r)</p>
                    <p><strong>æ— å¸¸æŸå¤±ï¼š</strong> IL = V_LP / V_HODL - 1 = 2âˆšr / (1+r) - 1</p>
                </div>
                
                <div class="warning-box">
                    <h4>âš ï¸ é‡è¦æé†’ï¼š</h4>
                    <ul style="margin-left: 20px;">
                        <li>æ— å¸¸æŸå¤±åªåœ¨é€€å‡ºæµåŠ¨æ€§æ± æ—¶"å®ç°"</li>
                        <li>ä»·æ ¼å›å½’åˆå§‹å€¼æ—¶ï¼Œæ— å¸¸æŸå¤±æ¶ˆå¤±</li>
                        <li>æ‰‹ç»­è´¹æ”¶ç›Šå¯èƒ½æŠµæ¶ˆæ— å¸¸æŸå¤±</li>
                        <li>é«˜æ³¢åŠ¨æ€§äº¤æ˜“å¯¹é¢ä¸´æ›´å¤§çš„ILé£é™©</li>
                    </ul>
                </div>
            </div>
            
            <!-- ç»¼åˆå¯¹æ¯” Tab -->
            <div id="comparison" class="tab-content">
                <h2>âš–ï¸ æ»‘ç‚¹ vs æ— å¸¸æŸå¤±å¯¹æ¯”</h2>
                
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>ç‰¹å¾</th>
                            <th>æ»‘ç‚¹ï¼ˆSlippageï¼‰</th>
                            <th>æ— å¸¸æŸå¤±ï¼ˆImpermanent Lossï¼‰</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>å®šä¹‰</strong></td>
                            <td>äº¤æ˜“æ—¶é¢„æœŸä»·æ ¼ä¸å®é™…æˆäº¤ä»·æ ¼çš„å·®å¼‚</td>
                            <td>æä¾›æµåŠ¨æ€§åï¼Œç›¸æ¯”ç®€å•æŒæœ‰çš„ä»·å€¼æŸå¤±</td>
                        </tr>
                        <tr>
                            <td><strong>å½±å“å¯¹è±¡</strong></td>
                            <td>äº¤æ˜“è€…ï¼ˆTradersï¼‰</td>
                            <td>æµåŠ¨æ€§æä¾›è€…ï¼ˆLPsï¼‰</td>
                        </tr>
                        <tr>
                            <td><strong>å‘ç”Ÿæ—¶æœº</strong></td>
                            <td>æ¯æ¬¡äº¤æ˜“æ—¶ç«‹å³å‘ç”Ÿ</td>
                            <td>ä»·æ ¼å˜åŠ¨åï¼Œé€€å‡ºæ± å­æ—¶å®ç°</td>
                        </tr>
                        <tr>
                            <td><strong>ä¸»è¦åŸå› </strong></td>
                            <td>æµåŠ¨æ€§æ·±åº¦ä¸è¶³ã€äº¤æ˜“è§„æ¨¡è¿‡å¤§</td>
                            <td>ä¸¤ç§èµ„äº§ä»·æ ¼æ¯”ä¾‹å˜åŒ–</td>
                        </tr>
                        <tr>
                            <td><strong>è®¡ç®—å¤æ‚åº¦</strong></td>
                            <td>ç®€å•ï¼ˆåŸºäºäº¤æ˜“é‡å’Œæ± å­å¤§å°ï¼‰</td>
                            <td>ä¸­ç­‰ï¼ˆåŸºäºä»·æ ¼æ¯”ç‡å˜åŒ–ï¼‰</td>
                        </tr>
                        <tr>
                            <td><strong>å¯é€†æ€§</strong></td>
                            <td>ä¸å¯é€†ï¼ˆäº¤æ˜“å®Œæˆå³ç¡®å®šï¼‰</td>
                            <td>å¯é€†ï¼ˆä»·æ ¼å›å½’æ—¶æ¶ˆå¤±ï¼‰</td>
                        </tr>
                        <tr>
                            <td><strong>ç¼“è§£æ–¹æ³•</strong></td>
                            <td>åˆ†æ‰¹äº¤æ˜“ã€é€‰æ‹©æ·±åº¦æ± å­ã€è®¾ç½®æ»‘ç‚¹ä¿æŠ¤</td>
                            <td>é€‰æ‹©ç›¸å…³æ€§é«˜çš„èµ„äº§å¯¹ã€æ”¶å–è¶³å¤Ÿæ‰‹ç»­è´¹</td>
                        </tr>
                    </tbody>
                </table>
                
                <h3>é£é™©åœºæ™¯æ¨¡æ‹Ÿ</h3>
                <div class="canvas-container">
                    <canvas id="riskScenarioCanvas" width="900" height="400"></canvas>
                </div>
                
                <div class="controls">
                    <div class="control-group">
                        <label>æ¨¡æ‹Ÿåœºæ™¯ï¼š</label>
                        <select id="scenario">
                            <option value="stable">ç¨³å®šå¸å¯¹ï¼ˆä½é£é™©ï¼‰</option>
                            <option value="correlated">ç›¸å…³èµ„äº§ï¼ˆä¸­é£é™©ï¼‰</option>
                            <option value="volatile">é«˜æ³¢åŠ¨å¯¹ï¼ˆé«˜é£é™©ï¼‰</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>æ—¶é—´è·¨åº¦ï¼ˆå¤©ï¼‰ï¼š</label>
                        <input type="number" id="timeSpan" value="30" min="1" max="365">
                    </div>
                    <div class="control-group">
                        <label>æ—¥å‡äº¤æ˜“é‡ï¼ˆ% of TVLï¼‰ï¼š</label>
                        <input type="number" id="dailyVolume" value="50" min="1" max="500">
                    </div>
                </div>
                
                <button onclick="simulateRisk()">è¿è¡Œæ¨¡æ‹Ÿ</button>
                
                <div class="info-grid">
                    <div class="info-card">
                        <div class="info-label">é¢„æœŸå¹´åŒ–æ”¶ç›Š</div>
                        <div class="info-value" id="expectedAPY">36.5%</div>
                    </div>
                    <div class="info-card">
                        <div class="info-label">æœ€å¤§ILé£é™©</div>
                        <div class="info-value" id="maxILRisk">5.7%</div>
                    </div>
                    <div class="info-card">
                        <div class="info-label">å¹³å‡æ»‘ç‚¹</div>
                        <div class="info-value" id="avgSlippage">0.5%</div>
                    </div>
                    <div class="info-card">
                        <div class="info-label">é£é™©è°ƒæ•´æ”¶ç›Š</div>
                        <div class="info-value" id="riskAdjustedReturn">30.8%</div>
                    </div>
                </div>
                
                <div class="success-box">
                    <h4>âœ… æœ€ä½³å®è·µå»ºè®®ï¼š</h4>
                    <ul style="margin-left: 20px;">
                        <li><strong>äº¤æ˜“è€…ï¼š</strong>
                            <ul style="margin-left: 20px; margin-top: 5px;">
                                <li>å¤§é¢äº¤æ˜“åˆ†æ‰¹æ‰§è¡Œ</li>
                                <li>ä½¿ç”¨èšåˆå™¨å¯»æ‰¾æœ€ä¼˜è·¯å¾„</li>
                                <li>è®¾ç½®åˆç†çš„æ»‘ç‚¹å®¹å¿åº¦ï¼ˆé€šå¸¸0.5%-1%ï¼‰</li>
                            </ul>
                        </li>
                        <li style="margin-top: 10px;"><strong>LPæä¾›è€…ï¼š</strong>
                            <ul style="margin-left: 20px; margin-top: 5px;">
                                <li>é€‰æ‹©ç›¸å…³æ€§é«˜çš„èµ„äº§å¯¹ï¼ˆå¦‚ç¨³å®šå¸ï¼‰</li>
                                <li>åœ¨é«˜äº¤æ˜“é‡æ± å­ä¸­æä¾›æµåŠ¨æ€§</li>
                                <li>å®šæœŸè¯„ä¼°IL vs æ‰‹ç»­è´¹æ”¶ç›Š</li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
            
            <!-- è®¡ç®—å™¨ Tab -->
            <div id="calculator" class="tab-content">
                <h2>ğŸ§® ç»¼åˆæ”¶ç›Šè®¡ç®—å™¨</h2>
                
                <div class="controls">
                    <h3>è¾“å…¥å‚æ•°</h3>
                    <div class="control-group">
                        <label>åˆå§‹æŠ•èµ„é‡‘é¢ï¼ˆUSDï¼‰ï¼š</label>
                        <input type="number" id="calcInvestment" value="10000" min="100">
                    </div>
                    <div class="control-group">
                        <label>ä»£å¸Aåˆå§‹ä»·æ ¼ï¼š</label>
                        <input type="number" id="calcTokenAPrice" value="2000" min="0.01">
                    </div>
                    <div class="control-group">
                        <label>ä»£å¸Båˆå§‹ä»·æ ¼ï¼š</label>
                        <input type="number" id="calcTokenBPrice" value="1" min="0.01">
                    </div>
                    <div class="control-group">
                        <label>é¢„æœŸä»·æ ¼å˜åŒ–ï¼ˆä»£å¸Aï¼‰ï¼š</label>
                        <input type="number" id="calcPriceChange" value="50" min="-99" max="1000" step="1">
                        <span>%</span>
                    </div>
                    <div class="control-group">
                        <label>æ± å­æ—¥äº¤æ˜“é‡ï¼ˆUSDï¼‰ï¼š</label>
                        <input type="number" id="calcDailyVolume" value="1000000" min="0">
                    </div>
                    <div class="control-group">
                        <label>æ± å­æ€»TVLï¼ˆUSDï¼‰ï¼š</label>
                        <input type="number" id="calcTVL" value="10000000" min="0">
                    </div>
                    <div class="control-group">
                        <label>æŒæœ‰æ—¶é—´ï¼ˆå¤©ï¼‰ï¼š</label>
                        <input type="number" id="calcDays" value="30" min="1" max="365">
                    </div>
                    <div class="control-group">
                        <label>æ‰‹ç»­è´¹ç‡ï¼š</label>
                        <select id="calcFeeRate">
                            <option value="0.0005">0.05% (ç¨³å®šå¸)</option>
                            <option value="0.003" selected>0.3% (æ ‡å‡†)</option>
                            <option value="0.01">1% (é«˜é£é™©)</option>
                        </select>
                    </div>
                </div>
                
                <button onclick="calculateReturns()">è®¡ç®—æ”¶ç›Š</button>
                
                <div class="result-container">
                    <h3>è®¡ç®—ç»“æœ</h3>
                    <div class="result-row">
                        <span>æ‚¨çš„æ± å­ä»½é¢ï¼š</span>
                        <span id="poolShare">0.10%</span>
                    </div>
                    <div class="result-row">
                        <span>é¢„æœŸæ‰‹ç»­è´¹æ”¶å…¥ï¼š</span>
                        <span id="feeIncome">$90</span>
                    </div>
                    <div class="result-row">
                        <span>æ— å¸¸æŸå¤±ï¼š</span>
                        <span id="calcIL">-$125</span>
                    </div>
                    <div class="result-row">
                        <span>LPæ€»ä»·å€¼ï¼š</span>
                        <span id="lpValue">$10,965</span>
                    </div>
                    <div class="result-row">
                        <span>HODLä»·å€¼ï¼š</span>
                        <span id="hodlValueCalc">$11,000</span>
                    </div>
                    <div class="result-row" style="color: #27ae60;">
                        <span>å‡€æ”¶ç›Šï¼š</span>
                        <span id="netReturn">-$35 (-0.35%)</span>
                    </div>
                </div>
                
                <h3>æ”¶ç›Šåˆ†è§£å›¾</h3>
                <div class="canvas-container">
                    <canvas id="returnBreakdownCanvas" width="900" height="400"></canvas>
                </div>
                
                <div class="warning-box">
                    <h4>ğŸ“Š è®¡ç®—è¯´æ˜ï¼š</h4>
                    <ul style="margin-left: 20px;">
                        <li>æ‰‹ç»­è´¹æ”¶å…¥ = æ‚¨çš„ä»½é¢ Ã— æ—¥äº¤æ˜“é‡ Ã— æ‰‹ç»­è´¹ç‡ Ã— å¤©æ•°</li>
                        <li>æ— å¸¸æŸå¤±åŸºäºä»·æ ¼å˜åŒ–æ¯”ç‡è®¡ç®—</li>
                        <li>å®é™…æ”¶ç›Šå¯èƒ½å› å¸‚åœºæ³¢åŠ¨è€Œå¼‚</li>
                        <li>æœªè€ƒè™‘å¤åˆ©æ•ˆåº”å’Œgasè´¹ç”¨</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // å…¨å±€å˜é‡
        let currentTab = 'slippage';
        
        // Tabåˆ‡æ¢
        function switchTab(tabName) {
            currentTab = tabName;
            
            // æ›´æ–°tabæŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // æ›´æ–°å†…å®¹æ˜¾ç¤º
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tabName).classList.add('active');
            
            // æ ¹æ®tabé‡æ–°ç»˜åˆ¶ç›¸åº”å›¾è¡¨
            switch(tabName) {
                case 'slippage':
                    drawSlippageCurve();
                    drawSlippageFactors();
                    break;
                case 'impermanent':
                    drawILCurve();
                    drawLPvsHODL();
                    break;
                case 'comparison':
                    drawRiskScenario();
                    break;
                case 'calculator':
                    drawReturnBreakdown();
                    break;
            }
        }
        
        // 1. æ»‘ç‚¹æ›²çº¿ç»˜åˆ¶
        function drawSlippageCurve() {
            const canvas = document.getElementById('slippageCanvas');
            const ctx = canvas.getContext('2d');
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const padding = 60;
            const width = canvas.width - 2 * padding;
            const height = canvas.height - 2 * padding;
            
            // è·å–æ± å­å‚æ•°
            const poolEth = parseFloat(document.getElementById('poolEth').value);
            const poolUsdc = parseFloat(document.getElementById('poolUsdc').value);
            const k = poolEth * poolUsdc;
            
            // ç»˜åˆ¶åæ ‡è½´
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, padding + height);
            ctx.lineTo(padding + width, padding + height);
            ctx.stroke();
            
            // ç»˜åˆ¶ä»·æ ¼æ›²çº¿
            ctx.strokeStyle = '#3498db';
            ctx.lineWidth = 3;
            ctx.beginPath();
            
            const maxTrade = poolEth * 0.5;
            const steps = 100;
            
            for (let i = 0; i <= steps; i++) {
                const tradeSize = (maxTrade * i) / steps;
                const newEth = poolEth - tradeSize;
                const newUsdc = k / newEth;
                const price = (newUsdc - poolUsdc) / tradeSize;
                
                const x = padding + (tradeSize / maxTrade) * width;
                const y = padding + height - ((price - 1500) / 2000) * height;
                
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            ctx.stroke();
            
            // ç»˜åˆ¶ç°è´§ä»·æ ¼çº¿
            const spotPrice = poolUsdc / poolEth;
            ctx.strokeStyle = '#2ecc71';
            ctx.lineWidth = 2;
            ctx.setLineDash([10, 5]);
            ctx.beginPath();
            ctx.moveTo(padding, padding + height - ((spotPrice - 1500) / 2000) * height);
            ctx.lineTo(padding + width, padding + height - ((spotPrice - 1500) / 2000) * height);
            ctx.stroke();
            ctx.setLineDash([]);
            
            // æ ‡è®°å½“å‰äº¤æ˜“ç‚¹
            const tradeAmount = parseFloat(document.getElementById('tradeAmount').value);
            if (tradeAmount > 0 && tradeAmount < maxTrade) {
                const newEth = poolEth - tradeAmount;
                const newUsdc = k / newEth;
                const execPrice = (newUsdc - poolUsdc) / tradeAmount;
                
                const tradeX = padding + (tradeAmount / maxTrade) * width;
                const tradeY = padding + height - ((execPrice - 1500) / 2000) * height;
                
                ctx.fillStyle = '#e74c3c';
                ctx.beginPath();
                ctx.arc(tradeX, tradeY, 8, 0, Math.PI * 2);
                ctx.fill();
            }
            
            // æ·»åŠ æ ‡ç­¾
            ctx.fillStyle = '#333';
            ctx.font = '14px Arial';
            ctx.fillText('äº¤æ˜“é‡ (ETH)', padding + width - 60, padding + height + 35);
            ctx.save();
            ctx.translate(25, padding + height/2);
            ctx.rotate(-Math.PI/2);
            ctx.fillText('ä»·æ ¼ (USDC/ETH)', 0, 0);
            ctx.restore();
        }
        
        // 2. æ»‘ç‚¹å½±å“å› ç´ 
        function drawSlippageFactors() {
            const canvas = document.getElementById('slippageFactorsCanvas');
            const ctx = canvas.getContext('2d');
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // ç»˜åˆ¶ä¸åŒæ± å­æ·±åº¦çš„æ»‘ç‚¹å¯¹æ¯”
            const scenarios = [
                { label: 'æµ…æ±  ($100k)', depth: 100000, color: '#e74c3c' },
                { label: 'ä¸­æ±  ($1M)', depth: 1000000, color: '#f39c12' },
                { label: 'æ·±æ±  ($10M)', depth: 10000000, color: '#27ae60' }
            ];
            
            const padding = 60;
            const width = canvas.width - 2 * padding;
            const height = canvas.height - 2 * padding;
            
            // åæ ‡è½´
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, padding + height);
            ctx.lineTo(padding + width, padding + height);
            ctx.stroke();
            
            // ç»˜åˆ¶æ¯ä¸ªåœºæ™¯çš„æ»‘ç‚¹æ›²çº¿
            scenarios.forEach(scenario => {
                ctx.strokeStyle = scenario.color;
                ctx.lineWidth = 2;
                ctx.beginPath();
                
                for (let i = 0; i <= 100; i++) {
                    const tradePercent = i / 100 * 0.2; // æœ€å¤§20%çš„äº¤æ˜“é‡
                    const slippage = tradePercent / (1 - tradePercent) * 100;
                    
                    const x = padding + (i / 100) * width;
                    const y = padding + height - (slippage / 10) * height;
                    
                    if (i === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                }
                ctx.stroke();
            });
            
            // å›¾ä¾‹
            scenarios.forEach((scenario, index) => {
                ctx.fillStyle = scenario.color;
                ctx.fillRect(padding + width - 150, padding + 20 + index * 25, 20, 3);
                ctx.fillStyle = '#333';
                ctx.font = '12px Arial';
                ctx.fillText(scenario.label, padding + width - 120, padding + 25 + index * 25);
            });
            
            // æ ‡ç­¾
            ctx.fillStyle = '#333';
            ctx.font = '14px Arial';
            ctx.fillText('äº¤æ˜“é‡å æ± å­æ¯”ä¾‹ (%)', padding + width/2 - 60, padding + height + 35);
        }
        
        // 3. æ— å¸¸æŸå¤±æ›²çº¿
        function drawILCurve() {
            const canvas = document.getElementById('ilCanvas');
            const ctx = canvas.getContext('2d');
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const padding = 60;
            const width = canvas.width - 2 * padding;
            const height = canvas.height - 2 * padding;
            
            // åæ ‡è½´
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(padding, padding + height/2);
            ctx.lineTo(padding + width, padding + height/2);
            ctx.moveTo(padding + width/2, padding);
            ctx.lineTo(padding + width/2, padding + height);
            ctx.stroke();
            
            // ILæ›²çº¿
            ctx.strokeStyle = '#e74c3c';
            ctx.lineWidth = 3;
            ctx.beginPath();
            
            for (let i = 0; i <= 200; i++) {
                const priceRatio = i / 20; // 0åˆ°10å€
                const il = (2 * Math.sqrt(priceRatio) / (1 + priceRatio) - 1) * 100;
                
                const x = padding + (i / 200) * width;
                const y = padding + height/2 - (il / 50) * height/2;
                
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            ctx.stroke();
            
            // æ ‡è®°å½“å‰ä»·æ ¼ç‚¹
            const initPrice = parseFloat(document.getElementById('initPrice').value);
            const currentPrice = parseFloat(document.getElementById('currentPrice').value);
            const ratio = currentPrice / initPrice;
            
            if (ratio > 0 && ratio < 10) {
                const currentIL = (2 * Math.sqrt(ratio) / (1 + ratio) - 1) * 100;
                const currentX = padding + (ratio / 10) * width;
                const currentY = padding + height/2 - (currentIL / 50) * height/2;
                
                ctx.fillStyle = '#3498db';
                ctx.beginPath();
                ctx.arc(currentX, currentY, 8, 0, Math.PI * 2);
                ctx.fill();
                
                // æ˜¾ç¤ºå½“å‰ILå€¼
                ctx.fillStyle = '#3498db';
                ctx.font = 'bold 14px Arial';
                ctx.fillText(`IL: ${currentIL.toFixed(2)}%`, currentX + 15, currentY - 10);
            }
            
            // æ·»åŠ å…³é”®ç‚¹æ ‡æ³¨
            const keyPoints = [
                { ratio: 0.5, label: '-2x' },
                { ratio: 1, label: '1x' },
                { ratio: 2, label: '2x' },
                { ratio: 3, label: '3x' },
                { ratio: 5, label: '5x' }
            ];
            
            keyPoints.forEach(point => {
                const il = (2 * Math.sqrt(point.ratio) / (1 + point.ratio) - 1) * 100;
                const x = padding + (point.ratio / 10) * width;
                const y = padding + height/2 - (il / 50) * height/2;
                
                ctx.fillStyle = '#666';
                ctx.beginPath();
                ctx.arc(x, y, 3, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.font = '12px Arial';
                ctx.fillText(point.label, x - 10, padding + height/2 + 20);
                ctx.fillText(`${il.toFixed(1)}%`, x - 15, y - 8);
            });
            
            // æ ‡ç­¾
            ctx.fillStyle = '#333';
            ctx.font = '14px Arial';
            ctx.fillText('ä»·æ ¼å˜åŒ–å€æ•°', padding + width - 60, padding + height/2 + 35);
            ctx.save();
            ctx.translate(padding + width/2 - 100, 25);
            ctx.fillText('æ— å¸¸æŸå¤± (%)', 0, 0);
            ctx.restore();
        }
        
        // 4. LP vs HODLå¯¹æ¯”
        function drawLPvsHODL() {
            const canvas = document.getElementById('lpVsHodlCanvas');
            const ctx = canvas.getContext('2d');
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const padding = 60;
            const width = canvas.width - 2 * padding;
            const height = canvas.height - 2 * padding;
            
            // åæ ‡è½´
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, padding + height);
            ctx.lineTo(padding + width, padding + height);
            ctx.stroke();
            
            const investment = parseFloat(document.getElementById('initialInvestment').value);
            const feeRate = parseFloat(document.getElementById('feeEarnings').value) / 100;
            
            // HODLæ›²çº¿
            ctx.strokeStyle = '#3498db';
            ctx.lineWidth = 3;
            ctx.beginPath();
            
            for (let i = 0; i <= 100; i++) {
                const priceRatio = i / 10; // 0åˆ°10å€
                const hodlValue = investment * 2 * (1 + priceRatio) / 2;
                
                const x = padding + (i / 100) * width;
                const y = padding + height - (hodlValue / (investment * 5)) * height;
                
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            ctx.stroke();
            
            // LPæ›²çº¿ï¼ˆå«æ‰‹ç»­è´¹ï¼‰
            ctx.strokeStyle = '#27ae60';
            ctx.lineWidth = 3;
            ctx.beginPath();
            
            for (let i = 0; i <= 100; i++) {
                const priceRatio = i / 10;
                const lpValue = investment * 2 * Math.sqrt(priceRatio);
                const totalValue = lpValue * (1 + feeRate);
                
                const x = padding + (i / 100) * width;
                const y = padding + height - (totalValue / (investment * 5)) * height;
                
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            ctx.stroke();
            
            // LPæ›²çº¿ï¼ˆä¸å«æ‰‹ç»­è´¹ï¼‰
            ctx.strokeStyle = '#e74c3c';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            
            for (let i = 0; i <= 100; i++) {
                const priceRatio = i / 10;
                const lpValue = investment * 2 * Math.sqrt(priceRatio);
                
                const x = padding + (i / 100) * width;
                const y = padding + height - (lpValue / (investment * 5)) * height;
                
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            ctx.stroke();
            ctx.setLineDash([]);
            
            // å›¾ä¾‹
            const legends = [
                { color: '#3498db', label: 'HODLç­–ç•¥' },
                { color: '#27ae60', label: 'LP+æ‰‹ç»­è´¹' },
                { color: '#e74c3c', label: 'LPæ— æ‰‹ç»­è´¹' }
            ];
            
            legends.forEach((legend, index) => {
                ctx.strokeStyle = legend.color;
                ctx.lineWidth = 3;
                if (index === 2) {
                    ctx.setLineDash([5, 5]);
                }
                ctx.beginPath();
                ctx.moveTo(padding + width - 150, padding + 20 + index * 25);
                ctx.lineTo(padding + width - 130, padding + 20 + index * 25);
                ctx.stroke();
                ctx.setLineDash([]);
                
                ctx.fillStyle = '#333';
                ctx.font = '12px Arial';
                ctx.fillText(legend.label, padding + width - 120, padding + 25 + index * 25);
            });
        }
        
        // 5. é£é™©åœºæ™¯æ¨¡æ‹Ÿ
        function drawRiskScenario() {
            const canvas = document.getElementById('riskScenarioCanvas');
            const ctx = canvas.getContext('2d');
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const scenario = document.getElementById('scenario').value;
            const timeSpan = parseInt(document.getElementById('timeSpan').value);
            
            const padding = 60;
            const width = canvas.width - 2 * padding;
            const height = canvas.height - 2 * padding;
            
            // åæ ‡è½´
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, padding + height);
            ctx.lineTo(padding + width, padding + height);
            ctx.stroke();
            
            // ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®
            let volatility = 0.01;
            let correlation = 0.95;
            
            switch(scenario) {
                case 'stable':
                    volatility = 0.001;
                    correlation = 0.99;
                    break;
                case 'correlated':
                    volatility = 0.02;
                    correlation = 0.8;
                    break;
                case 'volatile':
                    volatility = 0.05;
                    correlation = 0.5;
                    break;
            }
            
            // ç»˜åˆ¶ä»·æ ¼èµ°åŠ¿
            const priceData = [];
            let currentPrice = 1;
            
            for (let i = 0; i <= timeSpan; i++) {
                currentPrice *= (1 + (Math.random() - 0.5) * volatility * 2);
                priceData.push(currentPrice);
            }
            
            // ä»·æ ¼æ›²çº¿
            ctx.strokeStyle = '#3498db';
            ctx.lineWidth = 2;
            ctx.beginPath();
            
            priceData.forEach((price, index) => {
                const x = padding + (index / timeSpan) * width;
                const y = padding + height/2 - ((price - 1) * 2) * height/2;
                
                if (index === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });
            ctx.stroke();
            
            // ILåŒºåŸŸ
            ctx.fillStyle = 'rgba(231, 76, 60, 0.2)';
            ctx.beginPath();
            ctx.moveTo(padding, padding + height/2);
            
            priceData.forEach((price, index) => {
                const il = (2 * Math.sqrt(price) / (1 + price) - 1);
                const x = padding + (index / timeSpan) * width;
                const y = padding + height/2 - (il * 5) * height/2;
                ctx.lineTo(x, y);
            });
            
            ctx.lineTo(padding + width, padding + height/2);
            ctx.closePath();
            ctx.fill();
            
            // æ ‡ç­¾
            ctx.fillStyle = '#333';
            ctx.font = '14px Arial';
            ctx.fillText('æ—¶é—´ï¼ˆå¤©ï¼‰', padding + width - 40, padding + height + 35);
        }
        
        // 6. æ”¶ç›Šåˆ†è§£å›¾
        function drawReturnBreakdown() {
            const canvas = document.getElementById('returnBreakdownCanvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const investment = parseFloat(document.getElementById('calcInvestment').value) || 10000;
            const priceChange = parseFloat(document.getElementById('calcPriceChange').value) || 50;
            const ratio = 1 + priceChange / 100;
            
            // è®¡ç®—å„é¡¹æ”¶ç›Š
            const hodlReturn = investment * (ratio - 1);
            const il = investment * (2 * Math.sqrt(ratio) / (1 + ratio) - 1);
            const fees = investment * 0.05; // å‡è®¾5%æ‰‹ç»­è´¹æ”¶ç›Š
            const lpReturn = il + fees;
            
            // ç»˜åˆ¶æŸ±çŠ¶å›¾
            const categories = [
                { label: 'HODLæ”¶ç›Š', value: hodlReturn, color: '#3498db' },
                { label: 'æ— å¸¸æŸå¤±', value: il, color: '#e74c3c' },
                { label: 'æ‰‹ç»­è´¹æ”¶å…¥', value: fees, color: '#27ae60' },
                { label: 'LPå‡€æ”¶ç›Š', value: lpReturn, color: '#9b59b6' }
            ];
            
            const padding = 60;
            const width = canvas.width - 2 * padding;
            const height = canvas.height - 2 * padding;
            const barWidth = width / categories.length / 2;
            const maxValue = Math.max(...categories.map(c => Math.abs(c.value)));
            
            // ç»˜åˆ¶é›¶çº¿
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(padding, padding + height/2);
            ctx.lineTo(padding + width, padding + height/2);
            ctx.stroke();
            
            // ç»˜åˆ¶æŸ±çŠ¶å›¾
            categories.forEach((cat, index) => {
                const x = padding + (index + 0.5) * width / categories.length - barWidth/2;
                const barHeight = Math.abs(cat.value) / maxValue * height/2;
                const y = cat.value >= 0 
                    ? padding + height/2 - barHeight
                    : padding + height/2;
                
                ctx.fillStyle = cat.color;
                ctx.fillRect(x, y, barWidth, barHeight);
                
                // æ•°å€¼æ ‡ç­¾
                ctx.fillStyle = '#333';
                ctx.font = 'bold 14px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(
                    `$${cat.value.toFixed(0)}`,
                    x + barWidth/2,
                    cat.value >= 0 ? y - 10 : y + barHeight + 20
                );
                
                // ç±»åˆ«æ ‡ç­¾
                ctx.font = '12px Arial';
                ctx.fillText(cat.label, x + barWidth/2, padding + height + 25);
            });
        }
        
        // æ›´æ–°æ»‘å—æ˜¾ç¤ºå€¼
        document.getElementById('poolEth').addEventListener('input', function(e) {
            document.getElementById('poolEthDisplay').textContent = e.target.value;
            drawSlippageCurve();
        });
        
        document.getElementById('poolUsdc').addEventListener('input', function(e) {
            document.getElementById('poolUsdcDisplay').textContent = parseInt(e.target.value).toLocaleString();
            drawSlippageCurve();
        });
        
        document.getElementById('initPrice').addEventListener('input', function(e) {
            document.getElementById('initPriceDisplay').textContent = e.target.value;
            drawILCurve();
        });
        
        document.getElementById('currentPrice').addEventListener('input', function(e) {
            document.getElementById('currentPriceDisplay').textContent = e.target.value;
            drawILCurve();
        });
        
        // è®¡ç®—å‡½æ•°
        function calculateSlippage() {
            const poolEth = parseFloat(document.getElementById('poolEth').value);
            const poolUsdc = parseFloat(document.getElementById('poolUsdc').value);
            const tradeAmount = parseFloat(document.getElementById('tradeAmount').value);
            const tradeType = document.getElementById('tradeType').value;
            
            const k = poolEth * poolUsdc;
            const spotPrice = poolUsdc / poolEth;
            
            let executionPrice, slippage, cost;
            
            if (tradeType === 'buy') {
                const newEth = poolEth - tradeAmount;
                const newUsdc = k / newEth;
                const usdcNeeded = newUsdc - poolUsdc;
                executionPrice = usdcNeeded / tradeAmount;
                slippage = ((executionPrice - spotPrice) / spotPrice) * 100;
                cost = (executionPrice - spotPrice) * tradeAmount;
            } else {
                const newEth = poolEth + tradeAmount;
                const newUsdc = k / newEth;
                const usdcReceived = poolUsdc - newUsdc;
                executionPrice = usdcReceived / tradeAmount;
                slippage = ((spotPrice - executionPrice) / spotPrice) * 100;
                cost = (spotPrice - executionPrice) * tradeAmount;
            }
            
            document.getElementById('spotPrice').textContent = `$${spotPrice.toFixed(2)}`;
            document.getElementById('executionPrice').textContent = `$${executionPrice.toFixed(2)}`;
            document.getElementById('priceSlippage').textContent = `${slippage.toFixed(2)}%`;
            document.getElementById('slippageCost').textContent = `$${cost.toFixed(2)}`;
            
            drawSlippageCurve();
        }
        
        function calculateIL() {
            const initPrice = parseFloat(document.getElementById('initPrice').value);
            const currentPrice = parseFloat(document.getElementById('currentPrice').value);
            const investment = parseFloat(document.getElementById('initialInvestment').value);
            const feeEarnings = parseFloat(document.getElementById('feeEarnings').value) / 100;
            
            const priceRatio = currentPrice / initPrice;
            const priceChangePercent = ((priceRatio - 1) * 100).toFixed(2);
            
            const il = (2 * Math.sqrt(priceRatio) / (1 + priceRatio) - 1);
            const ilPercent = (il * 100).toFixed(2);
            const ilAmount = (investment * 2 * il).toFixed(2);
            
            const hodlValue = investment * 2 * (1 + priceRatio) / 2;
            const lpValue = investment * 2 * Math.sqrt(priceRatio);
            const fees = investment * 2 * feeEarnings;
            const lpTotalValue = lpValue + fees;
            const netProfit = lpTotalValue - investment * 2;
            
            document.getElementById('priceChange').textContent = `${priceChangePercent}%`;
            document.getElementById('ilPercentage').textContent = `${ilPercent}%`;
            document.getElementById('ilAmount').textContent = `$${ilAmount}`;
            document.getElementById('netProfit').textContent = `$${netProfit.toFixed(2)}`;
            
            document.getElementById('totalInvestment').textContent = `$${(investment * 2).toLocaleString()}`;
            document.getElementById('hodlValue').textContent = `$${hodlValue.toFixed(2)}`;
            document.getElementById('lpValueNoFees').textContent = `$${lpValue.toFixed(2)}`;
            document.getElementById('lpFees').textContent = `$${fees.toFixed(2)}`;
            document.getElementById('lpTotalValue').textContent = `$${lpTotalValue.toFixed(2)}`;
            document.getElementById('finalPnL').textContent = `${netProfit >= 0 ? '+' : ''}$${netProfit.toFixed(2)}`;
            
            drawILCurve();
            drawLPvsHODL();
        }
        
        function simulateRisk() {
            const scenario = document.getElementById('scenario').value;
            const timeSpan = parseInt(document.getElementById('timeSpan').value);
            const dailyVolume = parseFloat(document.getElementById('dailyVolume').value);
            
            let expectedAPY, maxIL, avgSlippage, riskAdjusted;
            
            switch(scenario) {
                case 'stable':
                    expectedAPY = dailyVolume * 0.0005 * 365; // 0.05% fee
                    maxIL = 0.5;
                    avgSlippage = 0.1;
                    break;
                case 'correlated':
                    expectedAPY = dailyVolume * 0.003 * 365; // 0.3% fee
                    maxIL = 5.7;
                    avgSlippage = 0.5;
                    break;
                case 'volatile':
                    expectedAPY = dailyVolume * 0.01 * 365; // 1% fee
                    maxIL = 25.5;
                    avgSlippage = 2.0;
                    break;
            }
            
            riskAdjusted = expectedAPY - maxIL;
            
            document.getElementById('expectedAPY').textContent = `${expectedAPY.toFixed(1)}%`;
            document.getElementById('maxILRisk').textContent = `${maxIL.toFixed(1)}%`;
            document.getElementById('avgSlippage').textContent = `${avgSlippage.toFixed(1)}%`;
            document.getElementById('riskAdjustedReturn').textContent = `${riskAdjusted.toFixed(1)}%`;
            
            drawRiskScenario();
        }
        
        function calculateReturns() {
            const investment = parseFloat(document.getElementById('calcInvestment').value);
            const tokenAPrice = parseFloat(document.getElementById('calcTokenAPrice').value);
            const tokenBPrice = parseFloat(document.getElementById('calcTokenBPrice').value);
            const priceChange = parseFloat(document.getElementById('calcPriceChange').value);
            const dailyVolume = parseFloat(document.getElementById('calcDailyVolume').value);
            const tvl = parseFloat(document.getElementById('calcTVL').value);
            const days = parseInt(document.getElementById('calcDays').value);
            const feeRate = parseFloat(document.getElementById('calcFeeRate').value);
            
            const poolShare = (investment / tvl) * 100;
            const dailyFees = dailyVolume * feeRate * (investment / tvl);
            const totalFees = dailyFees * days;
            
            const priceRatio = 1 + priceChange / 100;
            const il = investment * (2 * Math.sqrt(priceRatio) / (1 + priceRatio) - 1);
            const lpValue = investment * Math.sqrt(priceRatio) + totalFees;
            const hodlValue = investment * (1 + priceRatio) / 2 + investment / 2;
            const netReturn = lpValue - investment;
            const netReturnPercent = (netReturn / investment) * 100;
            
            document.getElementById('poolShare').textContent = `${poolShare.toFixed(4)}%`;
            document.getElementById('feeIncome').textContent = `$${totalFees.toFixed(2)}`;
            document.getElementById('calcIL').textContent = `$${il.toFixed(2)}`;
            document.getElementById('lpValue').textContent = `$${lpValue.toFixed(2)}`;
            document.getElementById('hodlValueCalc').textContent = `$${hodlValue.toFixed(2)}`;
            document.getElementById('netReturn').textContent = `${netReturn >= 0 ? '+' : ''}$${netReturn.toFixed(2)} (${netReturnPercent >= 0 ? '+' : ''}${netReturnPercent.toFixed(2)}%)`;
            
            drawReturnBreakdown();
        }
        
        // åˆå§‹åŒ–
        window.addEventListener('load', function() {
            drawSlippageCurve();
            drawSlippageFactors();
            calculateSlippage();
        });
    </script>
</body>
</html>