<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÊªëÁÇπ‰∏éÊó†Â∏∏ÊçüÂ§±Ê∑±Â∫¶ÂàÜÊûê</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 42px;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .section {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        h2 {
            color: #2c3e50;
            margin-bottom: 25px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
            font-size: 28px;
        }
        
        h3 {
            color: #34495e;
            margin: 20px 0 15px 0;
            font-size: 20px;
        }
        
        /* Tab Navigation */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .tab {
            padding: 12px 24px;
            background: none;
            border: none;
            font-size: 16px;
            font-weight: 600;
            color: #7f8c8d;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }
        
        .tab.active {
            color: #667eea;
        }
        
        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 3px;
            background: #667eea;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Canvas */
        .canvas-container {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
            position: relative;
        }
        
        canvas {
            display: block;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        /* Controls */
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            padding: 25px;
            background: linear-gradient(135deg, #667eea10, #764ba210);
            border-radius: 15px;
            margin: 25px 0;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .control-group label {
            font-weight: 600;
            color: #2c3e50;
            font-size: 14px;
        }
        
        .control-group span {
            color: #667eea;
            font-weight: bold;
        }
        
        input[type="range"] {
            -webkit-appearance: none;
            height: 8px;
            border-radius: 5px;
            background: #ddd;
            outline: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }
        
        input[type="number"], select {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input[type="number"]:focus, select:focus {
            border-color: #667eea;
            outline: none;
        }
        
        button {
            padding: 14px 28px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
        }
        
        /* Info Cards */
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }
        
        .info-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            transition: transform 0.3s;
        }
        
        .info-card:hover {
            transform: scale(1.05);
        }
        
        .info-value {
            font-size: 28px;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .info-label {
            font-size: 14px;
            opacity: 0.9;
        }
        
        /* Math Formulas */
        .formula-box {
            background: linear-gradient(135deg, #8e44ad, #9b59b6);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            text-align: center;
        }
        
        .math-explanation {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            border-left: 4px solid #667eea;
        }
        
        .example-box {
            background: #e8f4fd;
            border-left: 4px solid #3498db;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .warning-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .success-box {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        /* Result Display */
        .result-container {
            background: white;
            border: 2px solid #667eea;
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
        }
        
        .result-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .result-row:last-child {
            border-bottom: none;
            font-weight: bold;
            font-size: 18px;
            color: #667eea;
        }
        
        /* Comparison Table */
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        .comparison-table th {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px;
            text-align: left;
        }
        
        .comparison-table td {
            padding: 15px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .comparison-table tr:hover {
            background: #f8f9fa;
        }
        
        /* Legend */
        .legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .legend-color {
            width: 30px;
            height: 4px;
            border-radius: 2px;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 28px;
            }
            
            .tabs {
                flex-wrap: wrap;
            }
            
            .info-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä ÊªëÁÇπ‰∏éÊó†Â∏∏ÊçüÂ§±Ê∑±Â∫¶ÂàÜÊûêÂ∑•ÂÖ∑</h1>
            <p>ÁêÜËß£AMMÁöÑ‰∏§Â§ßÊ†∏ÂøÉÈ£éÈô©</p>
        </div>
        
        <!-- Tab Navigation -->
        <div class="section">
            <div class="tabs">
                <button class="tab active" onclick="switchTab('slippage')">ÊªëÁÇπÂàÜÊûê</button>
                <button class="tab" onclick="switchTab('impermanent')">Êó†Â∏∏ÊçüÂ§±</button>
                <button class="tab" onclick="switchTab('comparison')">ÁªºÂêàÂØπÊØî</button>
                <button class="tab" onclick="switchTab('calculator')">ËÆ°ÁÆóÂô®</button>
            </div>
            
            <!-- ÊªëÁÇπÂàÜÊûê Tab -->
            <div id="slippage" class="tab-content active">
                <h2>üéØ ÊªëÁÇπÔºàSlippageÔºâËØ¶Ëß£</h2>
                
                <div class="formula-box">
                    ÊªëÁÇπ = (ÊâßË°å‰ª∑Ê†º - È¢ÑÊúü‰ª∑Ê†º) / È¢ÑÊúü‰ª∑Ê†º √ó 100%
                </div>
                
                <h3>1. ÊªëÁÇπÂèØËßÜÂåñ</h3>
                <div class="canvas-container">
                    <canvas id="slippageCanvas" width="900" height="400"></canvas>
                    <div class="legend">
                        <div class="legend-item">
                            <div class="legend-color" style="background: #3498db;"></div>
                            <span>‰ª∑Ê†ºÊõ≤Á∫ø</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #e74c3c;"></div>
                            <span>ÂΩìÂâç‰∫§Êòì</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #2ecc71;"></div>
                            <span>Áé∞Ë¥ß‰ª∑Ê†º</span>
                        </div>
                    </div>
                </div>
                
                <div class="controls">
                    <div class="control-group">
                        <label>Ê±†Â≠ê‰∏≠ ETH Êï∞ÈáèÔºö<span id="poolEthDisplay">1000</span></label>
                        <input type="range" id="poolEth" min="100" max="10000" value="1000" step="100">
                    </div>
                    <div class="control-group">
                        <label>Ê±†Â≠ê‰∏≠ USDC Êï∞ÈáèÔºö<span id="poolUsdcDisplay">2,000,000</span></label>
                        <input type="range" id="poolUsdc" min="100000" max="10000000" value="2000000" step="100000">
                    </div>
                    <div class="control-group">
                        <label>‰∫§Êòì ETH Êï∞ÈáèÔºö</label>
                        <input type="number" id="tradeAmount" value="10" min="0.1" max="500" step="0.1">
                    </div>
                    <div class="control-group">
                        <label>‰∫§ÊòìÁ±ªÂûãÔºö</label>
                        <select id="tradeType">
                            <option value="buy">‰π∞ÂÖ• ETH</option>
                            <option value="sell">ÂçñÂá∫ ETH</option>
                        </select>
                    </div>
                </div>
                
                <button onclick="calculateSlippage()">ËÆ°ÁÆóÊªëÁÇπ</button>
                
                <div class="info-grid">
                    <div class="info-card">
                        <div class="info-label">Áé∞Ë¥ß‰ª∑Ê†º</div>
                        <div class="info-value" id="spotPrice">$2,000</div>
                    </div>
                    <div class="info-card">
                        <div class="info-label">ÊâßË°å‰ª∑Ê†º</div>
                        <div class="info-value" id="executionPrice">$2,020</div>
                    </div>
                    <div class="info-card">
                        <div class="info-label">‰ª∑Ê†ºÊªëÁÇπ</div>
                        <div class="info-value" id="priceSlippage">1.00%</div>
                    </div>
                    <div class="info-card">
                        <div class="info-label">ÊªëÁÇπÊàêÊú¨</div>
                        <div class="info-value" id="slippageCost">$200</div>
                    </div>
                </div>
                
                <h3>2. ÊªëÁÇπÂΩ±ÂìçÂõ†Á¥†ÂàÜÊûê</h3>
                <div class="canvas-container">
                    <canvas id="slippageFactorsCanvas" width="900" height="350"></canvas>
                </div>
                
                <div class="math-explanation">
                    <h4>ÊªëÁÇπËÆ°ÁÆóÂÖ¨ÂºèÊé®ÂØºÔºö</h4>
                    <p><strong>ÊÅíÂÆö‰πòÁßØÂÖ¨ÂºèÔºö</strong> x ¬∑ y = k</p>
                    <p><strong>‰∫§ÊòìÂâçÔºö</strong> x‚ÇÄ ¬∑ y‚ÇÄ = k</p>
                    <p><strong>‰∫§ÊòìŒîxÂêéÔºö</strong> (x‚ÇÄ + Œîx) ¬∑ (y‚ÇÄ - Œîy) = k</p>
                    <p><strong>Ê±ÇËß£ŒîyÔºö</strong> Œîy = y‚ÇÄ ¬∑ Œîx / (x‚ÇÄ + Œîx)</p>
                    <p><strong>ÊúâÊïà‰ª∑Ê†ºÔºö</strong> P_effective = Œîy / Œîx = y‚ÇÄ / (x‚ÇÄ + Œîx)</p>
                    <p><strong>ÊªëÁÇπÔºö</strong> Slippage = (P_effective - P_spot) / P_spot = Œîx / (x‚ÇÄ + Œîx)</p>
                </div>
                
                <div class="example-box">
                    <h4>üìù ÂÆû‰æãËÆ°ÁÆóÔºö</h4>
                    <p>Ê±†Â≠êÔºö1000 ETH √ó 2,000,000 USDC</p>
                    <p>Áé∞Ë¥ß‰ª∑Ê†ºÔºö2000 USDC/ETH</p>
                    <p>‰π∞ÂÖ• 10 ETHÔºö</p>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li>Êñ∞ETHÊï∞ÈáèÔºö1000 - 10 = 990 ETH</li>
                        <li>Êñ∞USDCÊï∞ÈáèÔºö2,000,000,000 / 990 = 2,020,202 USDC</li>
                        <li>ÈúÄÊîØ‰ªòÔºö2,020,202 - 2,000,000 = 20,202 USDC</li>
                        <li>ÊâßË°å‰ª∑Ê†ºÔºö20,202 / 10 = 2,020.2 USDC/ETH</li>
                        <li>ÊªëÁÇπÔºö(2020.2 - 2000) / 2000 = 1.01%</li>
                    </ul>
                </div>
            </div>
            
            <!-- Êó†Â∏∏ÊçüÂ§± Tab -->
            <div id="impermanent" class="tab-content">
                <h2>üíî Êó†Â∏∏ÊçüÂ§±ÔºàImpermanent LossÔºâËØ¶Ëß£</h2>
                
                <div class="formula-box">
                    IL = 2‚àö(‰ª∑Ê†ºÊØîÁéá) / (1 + ‰ª∑Ê†ºÊØîÁéá) - 1
                </div>
                
                <h3>1. Êó†Â∏∏ÊçüÂ§±Êõ≤Á∫ø</h3>
                <div class="canvas-container">
                    <canvas id="ilCanvas" width="900" height="400"></canvas>
                    <div class="legend">
                        <div class="legend-item">
                            <div class="legend-color" style="background: #e74c3c;"></div>
                            <span>Êó†Â∏∏ÊçüÂ§±Êõ≤Á∫ø</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #3498db;"></div>
                            <span>ÂΩìÂâçÊçüÂ§±ÁÇπ</span>
                        </div>
                    </div>
                </div>
                
                <div class="controls">
                    <div class="control-group">
                        <label>ÂàùÂßã ETH ‰ª∑Ê†ºÔºö$<span id="initPriceDisplay">2000</span></label>
                        <input type="range" id="initPrice" min="100" max="5000" value="2000" step="100">
                    </div>
                    <div class="control-group">
                        <label>ÂΩìÂâç ETH ‰ª∑Ê†ºÔºö$<span id="currentPriceDisplay">2000</span></label>
                        <input type="range" id="currentPrice" min="100" max="10000" value="2000" step="100">
                    </div>
                    <div class="control-group">
                        <label>ÂàùÂßãÊäïËµÑÔºàÊØèÁßç‰ª£Â∏ÅÔºâÔºö</label>
                        <input type="number" id="initialInvestment" value="10000" min="100" max="1000000">
                    </div>
                    <div class="control-group">
                        <label>LPÊâãÁª≠Ë¥πÊî∂ÁõäÔºà%ÔºâÔºö</label>
                        <input type="number" id="feeEarnings" value="5" min="0" max="100" step="0.1">
                    </div>
                </div>
                
                <button onclick="calculateIL()">ËÆ°ÁÆóÊó†Â∏∏ÊçüÂ§±</button>
                
                <div class="info-grid">
                    <div class="info-card">
                        <div class="info-label">‰ª∑Ê†ºÂèòÂåñ</div>
                        <div class="info-value" id="priceChange">0%</div>
                    </div>
                    <div class="info-card">
                        <div class="info-label">Êó†Â∏∏ÊçüÂ§±</div>
                        <div class="info-value" id="ilPercentage">0%</div>
                    </div>
                    <div class="info-card">
                        <div class="info-label">ÊçüÂ§±ÈáëÈ¢ù</div>
                        <div class="info-value" id="ilAmount">$0</div>
                    </div>
                    <div class="info-card">
                        <div class="info-label">ÂáÄÊî∂Áõä</div>
                        <div class="info-value" id="netProfit">$0</div>
                    </div>
                </div>
                
                <h3>2. LP vs HODL ÂØπÊØî</h3>
                <div class="canvas-container">
                    <canvas id="lpVsHodlCanvas" width="900" height="400"></canvas>
                </div>
                
                <div class="result-container">
                    <h4>ËØ¶ÁªÜÂØπÊØîÂàÜÊûê</h4>
                    <div class="result-row">
                        <span>ÂàùÂßãÊäïËµÑÊÄªÈ¢ùÔºö</span>
                        <span id="totalInvestment">$20,000</span>
                    </div>
                    <div class="result-row">
                        <span>HODLÁ≠ñÁï•‰ª∑ÂÄºÔºö</span>
                        <span id="hodlValue">$20,000</span>
                    </div>
                    <div class="result-row">
                        <span>LPÁ≠ñÁï•‰ª∑ÂÄºÔºà‰∏çÂê´Ë¥πÁî®ÔºâÔºö</span>
                        <span id="lpValueNoFees">$20,000</span>
                    </div>
                    <div class="result-row">
                        <span>LPÊâãÁª≠Ë¥πÊî∂ÁõäÔºö</span>
                        <span id="lpFees">$1,000</span>
                    </div>
                    <div class="result-row">
                        <span>LPÁ≠ñÁï•ÊÄª‰ª∑ÂÄºÔºö</span>
                        <span id="lpTotalValue">$21,000</span>
                    </div>
                    <div class="result-row">
                        <span>ÊúÄÁªàÊçüÁõäÔºö</span>
                        <span id="finalPnL">+$1,000</span>
                    </div>
                </div>
                
                <div class="math-explanation">
                    <h4>Êó†Â∏∏ÊçüÂ§±Êé®ÂØºÔºö</h4>
                    <p><strong>ËÆæÂÆöÔºö</strong></p>
                    <ul style="margin-left: 20px;">
                        <li>ÂàùÂßã‰ª∑Ê†ºÊØîÔºöp‚ÇÄ = 1</li>
                        <li>ÂΩìÂâç‰ª∑Ê†ºÊØîÔºöp‚ÇÅ = r</li>
                        <li>ÂàùÂßãÊäïËµÑÔºöÊØèÁßç‰ª£Â∏Å‰ª∑ÂÄºV</li>
                    </ul>
                    <p style="margin-top: 15px;"><strong>LP‰ª∑ÂÄºÔºö</strong> V_LP = 2V‚àör</p>
                    <p><strong>HODL‰ª∑ÂÄºÔºö</strong> V_HODL = V(1 + r)</p>
                    <p><strong>Êó†Â∏∏ÊçüÂ§±Ôºö</strong> IL = V_LP / V_HODL - 1 = 2‚àör / (1+r) - 1</p>
                </div>
                
                <div class="warning-box">
                    <h4>‚ö†Ô∏è ÈáçË¶ÅÊèêÈÜíÔºö</h4>
                    <ul style="margin-left: 20px;">
                        <li>Êó†Â∏∏ÊçüÂ§±Âè™Âú®ÈÄÄÂá∫ÊµÅÂä®ÊÄßÊ±†Êó∂"ÂÆûÁé∞"</li>
                        <li>‰ª∑Ê†ºÂõûÂΩíÂàùÂßãÂÄºÊó∂ÔºåÊó†Â∏∏ÊçüÂ§±Ê∂àÂ§±</li>
                        <li>ÊâãÁª≠Ë¥πÊî∂ÁõäÂèØËÉΩÊäµÊ∂àÊó†Â∏∏ÊçüÂ§±</li>
                        <li>È´òÊ≥¢Âä®ÊÄß‰∫§ÊòìÂØπÈù¢‰∏¥Êõ¥Â§ßÁöÑILÈ£éÈô©</li>
                    </ul>
                </div>
            </div>
            
            <!-- ÁªºÂêàÂØπÊØî Tab -->
            <div id="comparison" class="tab-content">
                <h2>‚öñÔ∏è ÊªëÁÇπ vs Êó†Â∏∏ÊçüÂ§±ÂØπÊØî</h2>
                
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>ÁâπÂæÅ</th>
                            <th>ÊªëÁÇπÔºàSlippageÔºâ</th>
                            <th>Êó†Â∏∏ÊçüÂ§±ÔºàImpermanent LossÔºâ</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>ÂÆö‰πâ</strong></td>
                            <td>‰∫§ÊòìÊó∂È¢ÑÊúü‰ª∑Ê†º‰∏éÂÆûÈôÖÊàê‰∫§‰ª∑Ê†ºÁöÑÂ∑ÆÂºÇ</td>
                            <td>Êèê‰æõÊµÅÂä®ÊÄßÂêéÔºåÁõ∏ÊØîÁÆÄÂçïÊåÅÊúâÁöÑ‰ª∑ÂÄºÊçüÂ§±</td>
                        </tr>
                        <tr>
                            <td><strong>ÂΩ±ÂìçÂØπË±°</strong></td>
                            <td>‰∫§ÊòìËÄÖÔºàTradersÔºâ</td>
                            <td>ÊµÅÂä®ÊÄßÊèê‰æõËÄÖÔºàLPsÔºâ</td>
                        </tr>
                        <tr>
                            <td><strong>ÂèëÁîüÊó∂Êú∫</strong></td>
                            <td>ÊØèÊ¨°‰∫§ÊòìÊó∂Á´ãÂç≥ÂèëÁîü</td>
                            <td>‰ª∑Ê†ºÂèòÂä®ÂêéÔºåÈÄÄÂá∫Ê±†Â≠êÊó∂ÂÆûÁé∞</td>
                        </tr>
                        <tr>
                            <td><strong>‰∏ªË¶ÅÂéüÂõ†</strong></td>
                            <td>ÊµÅÂä®ÊÄßÊ∑±Â∫¶‰∏çË∂≥„ÄÅ‰∫§ÊòìËßÑÊ®°ËøáÂ§ß</td>
                            <td>‰∏§ÁßçËµÑ‰∫ß‰ª∑Ê†ºÊØî‰æãÂèòÂåñ</td>
                        </tr>
                        <tr>
                            <td><strong>ËÆ°ÁÆóÂ§çÊùÇÂ∫¶</strong></td>
                            <td>ÁÆÄÂçïÔºàÂü∫‰∫é‰∫§ÊòìÈáèÂíåÊ±†Â≠êÂ§ßÂ∞èÔºâ</td>
                            <td>‰∏≠Á≠âÔºàÂü∫‰∫é‰ª∑Ê†ºÊØîÁéáÂèòÂåñÔºâ</td>
                        </tr>
                        <tr>
                            <td><strong>ÂèØÈÄÜÊÄß</strong></td>
                            <td>‰∏çÂèØÈÄÜÔºà‰∫§ÊòìÂÆåÊàêÂç≥Á°ÆÂÆöÔºâ</td>
                            <td>ÂèØÈÄÜÔºà‰ª∑Ê†ºÂõûÂΩíÊó∂Ê∂àÂ§±Ôºâ</td>
                        </tr>
                        <tr>
                            <td><strong>ÁºìËß£ÊñπÊ≥ï</strong></td>
                            <td>ÂàÜÊâπ‰∫§Êòì„ÄÅÈÄâÊã©Ê∑±Â∫¶Ê±†Â≠ê„ÄÅËÆæÁΩÆÊªëÁÇπ‰øùÊä§</td>
                            <td>ÈÄâÊã©Áõ∏ÂÖ≥ÊÄßÈ´òÁöÑËµÑ‰∫ßÂØπ„ÄÅÊî∂ÂèñË∂≥Â§üÊâãÁª≠Ë¥π</td>
                        </tr>
                    </tbody>
                </table>
                
                <h3>È£éÈô©Âú∫ÊôØÊ®°Êãü</h3>
                <div class="canvas-container">
                    <canvas id="riskScenarioCanvas" width="900" height="400"></canvas>
                </div>
                
                <div class="controls">
                    <div class="control-group">
                        <label>Ê®°ÊãüÂú∫ÊôØÔºö</label>
                        <select id="scenario">
                            <option value="stable">Á®≥ÂÆöÂ∏ÅÂØπÔºà‰ΩéÈ£éÈô©Ôºâ</option>
                            <option value="correlated">Áõ∏ÂÖ≥ËµÑ‰∫ßÔºà‰∏≠È£éÈô©Ôºâ</option>
                            <option value="volatile">È´òÊ≥¢Âä®ÂØπÔºàÈ´òÈ£éÈô©Ôºâ</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>Êó∂Èó¥Ë∑®Â∫¶ÔºàÂ§©ÔºâÔºö</label>
                        <input type="number" id="timeSpan" value="30" min="1" max="365">
                    </div>
                    <div class="control-group">
                        <label>Êó•Âùá‰∫§ÊòìÈáèÔºà% of TVLÔºâÔºö</label>
                        <input type="number" id="dailyVolume" value="50" min="1" max="500">
                    </div>
                </div>
                
                <button onclick="simulateRisk()">ËøêË°åÊ®°Êãü</button>
                
                <div class="info-grid">
                    <div class="info-card">
                        <div class="info-label">È¢ÑÊúüÂπ¥ÂåñÊî∂Áõä</div>
                        <div class="info-value" id="expectedAPY">36.5%</div>
                    </div>
                    <div class="info-card">
                        <div class="info-label">ÊúÄÂ§ßILÈ£éÈô©</div>
                        <div class="info-value" id="maxILRisk">5.7%</div>
                    </div>
                    <div class="info-card">
                        <div class="info-label">Âπ≥ÂùáÊªëÁÇπ</div>
                        <div class="info-value" id="avgSlippage">0.5%</div>
                    </div>
                    <div class="info-card">
                        <div class="info-label">È£éÈô©Ë∞ÉÊï¥Êî∂Áõä</div>
                        <div class="info-value" id="riskAdjustedReturn">30.8%</div>
                    </div>
                </div>
                
                <div class="success-box">
                    <h4>‚úÖ ÊúÄ‰Ω≥ÂÆûË∑µÂª∫ËÆÆÔºö</h4>
                    <ul style="margin-left: 20px;">
                        <li><strong>‰∫§ÊòìËÄÖÔºö</strong>
                            <ul style="margin-left: 20px; margin-top: 5px;">
                                <li>Â§ßÈ¢ù‰∫§ÊòìÂàÜÊâπÊâßË°å</li>
                                <li>‰ΩøÁî®ËÅöÂêàÂô®ÂØªÊâæÊúÄ‰ºòË∑ØÂæÑ</li>
                                <li>ËÆæÁΩÆÂêàÁêÜÁöÑÊªëÁÇπÂÆπÂøçÂ∫¶ÔºàÈÄöÂ∏∏0.5%-1%Ôºâ</li>
                            </ul>
                        </li>
                        <li style="margin-top: 10px;"><strong>LPÊèê‰æõËÄÖÔºö</strong>
                            <ul style="margin-left: 20px; margin-top: 5px;">
                                <li>ÈÄâÊã©Áõ∏ÂÖ≥ÊÄßÈ´òÁöÑËµÑ‰∫ßÂØπÔºàÂ¶ÇÁ®≥ÂÆöÂ∏ÅÔºâ</li>
                                <li>Âú®È´ò‰∫§ÊòìÈáèÊ±†Â≠ê‰∏≠Êèê‰æõÊµÅÂä®ÊÄß</li>
                                <li>ÂÆöÊúüËØÑ‰º∞IL vs ÊâãÁª≠Ë¥πÊî∂Áõä</li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
            
            <!-- ËÆ°ÁÆóÂô® Tab -->
            <div id="calculator" class="tab-content">
                <h2>üßÆ ÁªºÂêàÊî∂ÁõäËÆ°ÁÆóÂô®</h2>
                
                <div class="controls">
                    <h3>ËæìÂÖ•ÂèÇÊï∞</h3>
                    <div class="control-group">
                        <label>ÂàùÂßãÊäïËµÑÈáëÈ¢ùÔºàUSDÔºâÔºö</label>
                        <input type="number" id="calcInvestment" value="10000" min="100">
                    </div>
                    <div class="control-group">
                        <label>‰ª£Â∏ÅAÂàùÂßã‰ª∑Ê†ºÔºö</label>
                        <input type="number" id="calcTokenAPrice" value="2000" min="0.01">
                    </div>
                    <div class="control-group">
                        <label>‰ª£Â∏ÅBÂàùÂßã‰ª∑Ê†ºÔºö</label>
                        <input type="number" id="calcTokenBPrice" value="1" min="0.01">
                    </div>
                    <div class="control-group">
                        <label>È¢ÑÊúü‰ª∑Ê†ºÂèòÂåñÔºà‰ª£Â∏ÅAÔºâÔºö</label>
                        <input type="number" id="calcPriceChange" value="50" min="-99" max="1000" step="1">
                        <span>%</span>
                    </div>
                    <div class="control-group">
                        <label>Ê±†Â≠êÊó•‰∫§ÊòìÈáèÔºàUSDÔºâÔºö</label>
                        <input type="number" id="calcDailyVolume" value="1000000" min="0">
                    </div>
                    <div class="control-group">
                        <label>Ê±†Â≠êÊÄªTVLÔºàUSDÔºâÔºö</label>
                        <input type="number" id="calcTVL" value="10000000" min="0">
                    </div>
                    <div class="control-group">
                        <label>ÊåÅÊúâÊó∂Èó¥ÔºàÂ§©ÔºâÔºö</label>
                        <input type="number" id="calcDays" value="30" min="1" max="365">
                    </div>
                    <div class="control-group">
                        <label>ÊâãÁª≠Ë¥πÁéáÔºö</label>
                        <select id="calcFeeRate">
                            <option value="0.0005">0.05% (Á®≥ÂÆöÂ∏Å)</option>
                            <option value="0.003" selected>0.3% (Ê†áÂáÜ)</option>
                            <option value="0.01">1% (È´òÈ£éÈô©)</option>
                        </select>
                    </div>
                </div>
                
                <button onclick="calculateReturns()">ËÆ°ÁÆóÊî∂Áõä</button>
                
                <div class="result-container">
                    <h3>ËÆ°ÁÆóÁªìÊûú</h3>
                    <div class="result-row">
                        <span>ÊÇ®ÁöÑÊ±†Â≠ê‰ªΩÈ¢ùÔºö</span>
                        <span id="poolShare">0.10%</span>
                    </div>
                    <div class="result-row">
                        <span>È¢ÑÊúüÊâãÁª≠Ë¥πÊî∂ÂÖ•Ôºö</span>
                        <span id="feeIncome">$90</span>
                    </div>
                    <div class="result-row">
                        <span>Êó†Â∏∏ÊçüÂ§±Ôºö</span>
                        <span id="calcIL">-$125</span>
                    </div>
                    <div class="result-row">
                        <span>LPÊÄª‰ª∑ÂÄºÔºö</span>
                        <span id="lpValue">$10,965</span>
                    </div>
                    <div class="result-row">
                        <span>HODL‰ª∑ÂÄºÔºö</span>
                        <span id="hodlValueCalc">$11,000</span>
                    </div>
                    <div class="result-row" style="color: #27ae60;">
                        <span>ÂáÄÊî∂ÁõäÔºö</span>
                        <span id="netReturn">-$35 (-0.35%)</span>
                    </div>
                </div>
                
                <h3>Êî∂ÁõäÂàÜËß£Âõæ</h3>
                <div class="canvas-container">
                    <canvas id="returnBreakdownCanvas" width="900" height="400"></canvas>
                </div>
                
                <div class="warning-box">
                    <h4>üìä ËÆ°ÁÆóËØ¥ÊòéÔºö</h4>
                    <ul style="margin-left: 20px;">
                        <li>ÊâãÁª≠Ë¥πÊî∂ÂÖ• = ÊÇ®ÁöÑ‰ªΩÈ¢ù √ó Êó•‰∫§ÊòìÈáè √ó ÊâãÁª≠Ë¥πÁéá √ó Â§©Êï∞</li>
                        <li>Êó†Â∏∏ÊçüÂ§±Âü∫‰∫é‰ª∑Ê†ºÂèòÂåñÊØîÁéáËÆ°ÁÆó</li>
                        <li>ÂÆûÈôÖÊî∂ÁõäÂèØËÉΩÂõ†Â∏ÇÂú∫Ê≥¢Âä®ËÄåÂºÇ</li>
                        <li>Êú™ËÄÉËôëÂ§çÂà©ÊïàÂ∫îÂíågasË¥πÁî®</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // ÂÖ®Â±ÄÂèòÈáè
        let currentTab = 'slippage';
        
        // TabÂàáÊç¢
        function switchTab(tabName) {
            currentTab = tabName;
            
            // Êõ¥Êñ∞tabÊåâÈíÆÁä∂ÊÄÅ
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Êõ¥Êñ∞ÂÜÖÂÆπÊòæÁ§∫
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tabName).classList.add('active');
            
            // Ê†πÊçÆtabÈáçÊñ∞ÁªòÂà∂Áõ∏Â∫îÂõæË°®
            switch(tabName) {
                case 'slippage':
                    drawSlippageCurve();
                    drawSlippageFactors();
                    break;
                case 'impermanent':
                    drawILCurve();
                    drawLPvsHODL();
                    break;
                case 'comparison':
                    drawRiskScenario();
                    break;
                case 'calculator':
                    drawReturnBreakdown();
                    break;
            }
        }
        
        // 1. ÊªëÁÇπÊõ≤Á∫øÁªòÂà∂
        function drawSlippageCurve() {
            const canvas = document.getElementById('slippageCanvas');
            const ctx = canvas.getContext('2d');
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const padding = 60;
            const width = canvas.width - 2 * padding;
            const height = canvas.height - 2 * padding;
            
            // Ëé∑ÂèñÊ±†Â≠êÂèÇÊï∞
            const poolEth = parseFloat(document.getElementById('poolEth').value);
            const poolUsdc = parseFloat(document.getElementById('poolUsdc').value);
            const k = poolEth * poolUsdc;
            
            // ÁªòÂà∂ÂùêÊ†áËΩ¥
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, padding + height);
            ctx.lineTo(padding + width, padding + height);
            ctx.stroke();
            
            // ÁªòÂà∂‰ª∑Ê†ºÊõ≤Á∫ø
            ctx.strokeStyle = '#3498db';
            ctx.lineWidth = 3;
            ctx.beginPath();
            
            const maxTrade = poolEth * 0.5;
            const steps = 100;
            
            for (let i = 0; i <= steps; i++) {
                const tradeSize = (maxTrade * i) / steps;
                const newEth = poolEth - tradeSize;
                const newUsdc = k / newEth;
                const price = (newUsdc - poolUsdc) / tradeSize;
                
                const x = padding + (tradeSize / maxTrade) * width;
                const y = padding + height - ((price - 1500) / 2000) * height;
                
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            ctx.stroke();
            
            // ÁªòÂà∂Áé∞Ë¥ß‰ª∑Ê†ºÁ∫ø
            const spotPrice = poolUsdc / poolEth;
            ctx.strokeStyle = '#2ecc71';
            ctx.lineWidth = 2;
            ctx.setLineDash([10, 5]);
            ctx.beginPath();
            ctx.moveTo(padding, padding + height - ((spotPrice - 1500) / 2000) * height);
            ctx.lineTo(padding + width, padding + height - ((spotPrice - 1500) / 2000) * height);
            ctx.stroke();
            ctx.setLineDash([]);
            
            // Ê†áËÆ∞ÂΩìÂâç‰∫§ÊòìÁÇπ
            const tradeAmount = parseFloat(document.getElementById('tradeAmount').value);
            if (tradeAmount > 0 && tradeAmount < maxTrade) {
                const newEth = poolEth - tradeAmount;
                const newUsdc = k / newEth;
                const execPrice = (newUsdc - poolUsdc) / tradeAmount;
                
                const tradeX = padding + (tradeAmount / maxTrade) * width;
                const tradeY = padding + height - ((execPrice - 1500) / 2000) * height;
                
                ctx.fillStyle = '#e74c3c';
                ctx.beginPath();
                ctx.arc(tradeX, tradeY, 8, 0, Math.PI * 2);
                ctx.fill();
            }
            
            // Ê∑ªÂä†Ê†áÁ≠æ
            ctx.fillStyle = '#333';
            ctx.font = '14px Arial';
            ctx.fillText('‰∫§ÊòìÈáè (ETH)', padding + width - 60, padding + height + 35);
            ctx.save();
            ctx.translate(25, padding + height/2);
            ctx.rotate(-Math.PI/2);
            ctx.fillText('‰ª∑Ê†º (USDC/ETH)', 0, 0);
            ctx.restore();
        }
        
        // 2. ÊªëÁÇπÂΩ±ÂìçÂõ†Á¥†
        function drawSlippageFactors() {
            const canvas = document.getElementById('slippageFactorsCanvas');
            const ctx = canvas.getContext('2d');
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // ÁªòÂà∂‰∏çÂêåÊ±†Â≠êÊ∑±Â∫¶ÁöÑÊªëÁÇπÂØπÊØî
            const scenarios = [
                { label: 'ÊµÖÊ±† ($100k)', depth: 100000, color: '#e74c3c' },
                { label: '‰∏≠Ê±† ($1M)', depth: 1000000, color: '#f39c12' },
                { label: 'Ê∑±Ê±† ($10M)', depth: 10000000, color: '#27ae60' }
            ];
            
            const padding = 60;
            const width = canvas.width - 2 * padding;
            const height = canvas.height - 2 * padding;
            
            // ÂùêÊ†áËΩ¥
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, padding + height);
            ctx.lineTo(padding + width, padding + height);
            ctx.stroke();
            
            // ÁªòÂà∂ÊØè‰∏™Âú∫ÊôØÁöÑÊªëÁÇπÊõ≤Á∫ø
            scenarios.forEach(scenario => {
                ctx.strokeStyle = scenario.color;
                ctx.lineWidth = 2;
                ctx.beginPath();
                
                for (let i = 0; i <= 100; i++) {
                    const tradePercent = i / 100 * 0.2; // ÊúÄÂ§ß20%ÁöÑ‰∫§ÊòìÈáè
                    const slippage = tradePercent / (1 - tradePercent) * 100;
                    
                    const x = padding + (i / 100) * width;
                    const y = padding + height - (slippage / 10) * height;
                    
                    if (i === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                }
                ctx.stroke();
            });
            
            // Âõæ‰æã
            scenarios.forEach((scenario, index) => {
                ctx.fillStyle = scenario.color;
                ctx.fillRect(padding + width - 150, padding + 20 + index * 25, 20, 3);
                ctx.fillStyle = '#333';
                ctx.font = '12px Arial';
                ctx.fillText(scenario.label, padding + width - 120, padding + 25 + index * 25);
            });
            
            // Ê†áÁ≠æ
            ctx.fillStyle = '#333';
            ctx.font = '14px Arial';
            ctx.fillText('‰∫§ÊòìÈáèÂç†Ê±†Â≠êÊØî‰æã (%)', padding + width/2 - 60, padding + height + 35);
        }
        
        // 3. Êó†Â∏∏ÊçüÂ§±Êõ≤Á∫ø
        function drawILCurve() {
            const canvas = document.getElementById('ilCanvas');
            const ctx = canvas.getContext('2d');
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const padding = 60;
            const width = canvas.width - 2 * padding;
            const height = canvas.height - 2 * padding;
            
            // ÂùêÊ†áËΩ¥
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(padding, padding + height/2);
            ctx.lineTo(padding + width, padding + height/2);
            ctx.moveTo(padding + width/2, padding);
            ctx.lineTo(padding + width/2, padding + height);
            ctx.stroke();
            
            // ILÊõ≤Á∫ø
            ctx.strokeStyle = '#e74c3c';
            ctx.lineWidth = 3;
            ctx.beginPath();
            
            for (let i = 0; i <= 200; i++) {
                const priceRatio = i / 20; // 0Âà∞10ÂÄç
                const il = (2 * Math.sqrt(priceRatio) / (1 + priceRatio) - 1) * 100;
                
                const x = padding + (i / 200) * width;
                const y = padding + height/2 - (il / 50) * height/2;
                
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            ctx.stroke();
            
            // Ê†áËÆ∞ÂΩìÂâç‰ª∑Ê†ºÁÇπ
            const initPrice = parseFloat(document.getElementById('initPrice').value);
            const currentPrice = parseFloat(document.getElementById('currentPrice').value);
            const ratio = currentPrice / initPrice;
            
            if (ratio > 0 && ratio < 10) {
                const currentIL = (2 * Math.sqrt(ratio) / (1 + ratio) - 1) * 100;
                const currentX = padding + (ratio / 10) * width;
                const currentY = padding + height/2 - (currentIL / 50) * height/2;
                
                ctx.fillStyle = '#3498db';
                ctx.beginPath();
                ctx.arc(currentX, currentY, 8, 0, Math.PI * 2);
                ctx.fill();
                
                // ÊòæÁ§∫ÂΩìÂâçILÂÄº
                ctx.fillStyle = '#3498db';
                ctx.font = 'bold 14px Arial';
                ctx.fillText(`IL: ${currentIL.toFixed(2)}%`, currentX + 15, currentY - 10);
            }
            
            // Ê∑ªÂä†ÂÖ≥ÈîÆÁÇπÊ†áÊ≥®
            const keyPoints = [
                { ratio: 0.5, label: '-2x' },
                { ratio: 1, label: '1x' },
                { ratio: 2, label: '2x' },
                { ratio: 3, label: '3x' },
                { ratio: 5, label: '5x' }
            ];
            
            keyPoints.forEach(point => {
                const il = (2 * Math.sqrt(point.ratio) / (1 + point.ratio) - 1) * 100;
                const x = padding + (point.ratio / 10) * width;
                const y = padding + height/2 - (il / 50) * height/2;
                
                ctx.fillStyle = '#666';
                ctx.beginPath();
                ctx.arc(x, y, 3, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.font = '12px Arial';
                ctx.fillText(point.label, x - 10, padding + height/2 + 20);
                ctx.fillText(`${il.toFixed(1)}%`, x - 15, y - 8);
            });
            
            // Ê†áÁ≠æ
            ctx.fillStyle = '#333';
            ctx.font = '14px Arial';
            ctx.fillText('‰ª∑Ê†ºÂèòÂåñÂÄçÊï∞', padding + width - 60, padding + height/2 + 35);
            ctx.save();
            ctx.translate(padding + width/2 - 100, 25);
            ctx.fillText('Êó†Â∏∏ÊçüÂ§± (%)', 0, 0);
            ctx.restore();
        }
        
        // 4. LP vs HODLÂØπÊØî
        function drawLPvsHODL() {
            const canvas = document.getElementById('lpVsHodlCanvas');
            const ctx = canvas.getContext('2d');
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const padding = 60;
            const width = canvas.width - 2 * padding;
            const height = canvas.height - 2 * padding;
            
            // ÂùêÊ†áËΩ¥
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, padding + height);
            ctx.lineTo(padding + width, padding + height);
            ctx.stroke();
            
            const investment = parseFloat(document.getElementById('initialInvestment').value);
            const feeRate = parseFloat(document.getElementById('feeEarnings').value) / 100;
            
            // HODLÊõ≤Á∫ø
            ctx.strokeStyle = '#3498db';
            ctx.lineWidth = 3;
            ctx.beginPath();
            
            for (let i = 0; i <= 100; i++) {
                const priceRatio = i / 10; // 0Âà∞10ÂÄç
                const hodlValue = investment * 2 * (1 + priceRatio) / 2;
                
                const x = padding + (i / 100) * width;
                const y = padding + height - (hodlValue / (investment * 5)) * height;
                
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            ctx.stroke();
            
            // LPÊõ≤Á∫øÔºàÂê´ÊâãÁª≠Ë¥πÔºâ
            ctx.strokeStyle = '#27ae60';
            ctx.lineWidth = 3;
            ctx.beginPath();
            
            for (let i = 0; i <= 100; i++) {
                const priceRatio = i / 10;
                const lpValue = investment * 2 * Math.sqrt(priceRatio);
                const totalValue = lpValue * (1 + feeRate);
                
                const x = padding + (i / 100) * width;
                const y = padding + height - (totalValue / (investment * 5)) * height;
                
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            ctx.stroke();
            
            // LPÊõ≤Á∫øÔºà‰∏çÂê´ÊâãÁª≠Ë¥πÔºâ
            ctx.strokeStyle = '#e74c3c';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            
            for (let i = 0; i <= 100; i++) {
                const priceRatio = i / 10;
                const lpValue = investment * 2 * Math.sqrt(priceRatio);
                
                const x = padding + (i / 100) * width;
                const y = padding + height - (lpValue / (investment * 5)) * height;
                
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            ctx.stroke();
            ctx.setLineDash([]);
            
            // Âõæ‰æã
            const legends = [
                { color: '#3498db', label: 'HODLÁ≠ñÁï•' },
                { color: '#27ae60', label: 'LP+ÊâãÁª≠Ë¥π' },
                { color: '#e74c3c', label: 'LPÊó†ÊâãÁª≠Ë¥π' }
            ];
            
            legends.forEach((legend, index) => {
                ctx.strokeStyle = legend.color;
                ctx.lineWidth = 3;
                if (index === 2) {
                    ctx.setLineDash([5, 5]);
                }
                ctx.beginPath();
                ctx.moveTo(padding + width - 150, padding + 20 + index * 25);
                ctx.lineTo(padding + width - 130, padding + 20 + index * 25);
                ctx.stroke();
                ctx.setLineDash([]);
                
                ctx.fillStyle = '#333';
                ctx.font = '12px Arial';
                ctx.fillText(legend.label, padding + width - 120, padding + 25 + index * 25);
            });
        }
        
        // 5. È£éÈô©Âú∫ÊôØÊ®°Êãü
        function drawRiskScenario() {
            const canvas = document.getElementById('riskScenarioCanvas');
            const ctx = canvas.getContext('2d');
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const scenario = document.getElementById('scenario').value;
            const timeSpan = parseInt(document.getElementById('timeSpan').value);
            
            const padding = 60;
            const width = canvas.width - 2 * padding;
            const height = canvas.height - 2 * padding;
            
            // ÂùêÊ†áËΩ¥
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, padding + height);
            ctx.lineTo(padding + width, padding + height);
            ctx.stroke();
            
            // ÁîüÊàêÊ®°ÊãüÊï∞ÊçÆ
            let volatility = 0.01;
            let correlation = 0.95;
            
            switch(scenario) {
                case 'stable':
                    volatility = 0.001;
                    correlation = 0.99;
                    break;
                case 'correlated':
                    volatility = 0.02;
                    correlation = 0.8;
                    break;
                case 'volatile':
                    volatility = 0.05;
                    correlation = 0.5;
                    break;
            }
            
            // ÁªòÂà∂‰ª∑Ê†ºËµ∞Âäø
            const priceData = [];
            let currentPrice = 1;
            
            for (let i = 0; i <= timeSpan; i++) {
                currentPrice *= (1 + (Math.random() - 0.5) * volatility * 2);
                priceData.push(currentPrice);
            }
            
            // ‰ª∑Ê†ºÊõ≤Á∫ø
            ctx.strokeStyle = '#3498db';
            ctx.lineWidth = 2;
            ctx.beginPath();
            
            priceData.forEach((price, index) => {
                const x = padding + (index / timeSpan) * width;
                const y = padding + height/2 - ((price - 1) * 2) * height/2;
                
                if (index === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });
            ctx.stroke();
            
            // ILÂå∫Âüü
            ctx.fillStyle = 'rgba(231, 76, 60, 0.2)';
            ctx.beginPath();
            ctx.moveTo(padding, padding + height/2);
            
            priceData.forEach((price, index) => {
                const il = (2 * Math.sqrt(price) / (1 + price) - 1);
                const x = padding + (index / timeSpan) * width;
                const y = padding + height/2 - (il * 5) * height/2;
                ctx.lineTo(x, y);
            });
            
            ctx.lineTo(padding + width, padding + height/2);
            ctx.closePath();
            ctx.fill();
            
            // Ê†áÁ≠æ
            ctx.fillStyle = '#333';
            ctx.font = '14px Arial';
            ctx.fillText('Êó∂Èó¥ÔºàÂ§©Ôºâ', padding + width - 40, padding + height + 35);
        }
        
        // 6. Êî∂ÁõäÂàÜËß£Âõæ
        function drawReturnBreakdown() {
            const canvas = document.getElementById('returnBreakdownCanvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const investment = parseFloat(document.getElementById('calcInvestment').value) || 10000;
            const priceChange = parseFloat(document.getElementById('calcPriceChange').value) || 50;
            const ratio = 1 + priceChange / 100;
            
            // ËÆ°ÁÆóÂêÑÈ°πÊî∂Áõä
            const hodlReturn = investment * (ratio - 1);
            const il = investment * (2 * Math.sqrt(ratio) / (1 + ratio) - 1);
            const fees = investment * 0.05; // ÂÅáËÆæ5%ÊâãÁª≠Ë¥πÊî∂Áõä
            const lpReturn = il + fees;
            
            // ÁªòÂà∂Êü±Áä∂Âõæ
            const categories = [
                { label: 'HODLÊî∂Áõä', value: hodlReturn, color: '#3498db' },
                { label: 'Êó†Â∏∏ÊçüÂ§±', value: il, color: '#e74c3c' },
                { label: 'ÊâãÁª≠Ë¥πÊî∂ÂÖ•', value: fees, color: '#27ae60' },
                { label: 'LPÂáÄÊî∂Áõä', value: lpReturn, color: '#9b59b6' }
            ];
            
            const padding = 60;
            const width = canvas.width - 2 * padding;
            const height = canvas.height - 2 * padding;
            const barWidth = width / categories.length / 2;
            const maxValue = Math.max(...categories.map(c => Math.abs(c.value)));
            
            // ÁªòÂà∂Èõ∂Á∫ø
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(padding, padding + height/2);
            ctx.lineTo(padding + width, padding + height/2);
            ctx.stroke();
            
            // ÁªòÂà∂Êü±Áä∂Âõæ
            categories.forEach((cat, index) => {
                const x = padding + (index + 0.5) * width / categories.length - barWidth/2;
                const barHeight = Math.abs(cat.value) / maxValue * height/2;
                const y = cat.value >= 0 
                    ? padding + height/2 - barHeight
                    : padding + height/2;
                
                ctx.fillStyle = cat.color;
                ctx.fillRect(x, y, barWidth, barHeight);
                
                // Êï∞ÂÄºÊ†áÁ≠æ
                ctx.fillStyle = '#333';
                ctx.font = 'bold 14px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(
                    `$${cat.value.toFixed(0)}`,
                    x + barWidth/2,
                    cat.value >= 0 ? y - 10 : y + barHeight + 20
                );
                
                // Á±ªÂà´Ê†áÁ≠æ
                ctx.font = '12px Arial';
                ctx.fillText(cat.label, x + barWidth/2, padding + height + 25);
            });
        }
        
        // Êõ¥Êñ∞ÊªëÂùóÊòæÁ§∫ÂÄº
        document.getElementById('poolEth').addEventListener('input', function(e) {
            document.getElementById('poolEthDisplay').textContent = e.target.value;
            drawSlippageCurve();
        });
        
        document.getElementById('poolUsdc').addEventListener('input', function(e) {
            document.getElementById('poolUsdcDisplay').textContent = parseInt(e.target.value).toLocaleString();
            drawSlippageCurve();
        });
        
        document.getElementById('initPrice').addEventListener('input', function(e) {
            document.getElementById('initPriceDisplay').textContent = e.target.value;
            drawILCurve();
        });
        
        document.getElementById('currentPrice').addEventListener('input', function(e) {
            document.getElementById('currentPriceDisplay').textContent = e.target.value;
            drawILCurve();
        });
        
        // ËÆ°ÁÆóÂáΩÊï∞
        function calculateSlippage() {
            const poolEth = parseFloat(document.getElementById('poolEth').value);
            const poolUsdc = parseFloat(document.getElementById('poolUsdc').value);
            const tradeAmount = parseFloat(document.getElementById('tradeAmount').value);
            const tradeType = document.getElementById('tradeType').value;
            
            const k = poolEth * poolUsdc;
            const spotPrice = poolUsdc / poolEth;
            
            let executionPrice, slippage, cost;
            
            if (tradeType === 'buy') {
                const newEth = poolEth - tradeAmount;
                const newUsdc = k / newEth;
                const usdcNeeded = newUsdc - poolUsdc;
                executionPrice = usdcNeeded / tradeAmount;
                slippage = ((executionPrice - spotPrice) / spotPrice) * 100;
                cost = (executionPrice - spotPrice) * tradeAmount;
            } else {
                const newEth = poolEth + tradeAmount;
                const newUsdc = k / newEth;
                const usdcReceived = poolUsdc - newUsdc;
                executionPrice = usdcReceived / tradeAmount;
                slippage = ((spotPrice - executionPrice) / spotPrice) * 100;
                cost = (spotPrice - executionPrice) * tradeAmount;
            }
            
            document.getElementById('spotPrice').textContent = `$${spotPrice.toFixed(2)}`;
            document.getElementById('executionPrice').textContent = `$${executionPrice.toFixed(2)}`;
            document.getElementById('priceSlippage').textContent = `${slippage.toFixed(2)}%`;
            document.getElementById('slippageCost').textContent = `$${cost.toFixed(2)}`;
            
            drawSlippageCurve();
        }
        
        function calculateIL() {
            const initPrice = parseFloat(document.getElementById('initPrice').value);
            const currentPrice = parseFloat(document.getElementById('currentPrice').value);
            const investment = parseFloat(document.getElementById('initialInvestment').value);
            const feeEarnings = parseFloat(document.getElementById('feeEarnings').value) / 100;
            
            const priceRatio = currentPrice / initPrice;
            const priceChangePercent = ((priceRatio - 1) * 100).toFixed(2);
            
            const il = (2 * Math.sqrt(priceRatio) / (1 + priceRatio) - 1);
            const ilPercent = (il * 100).toFixed(2);
            const ilAmount = (investment * 2 * il).toFixed(2);
            
            const hodlValue = investment * 2 * (1 + priceRatio) / 2;
            const lpValue = investment * 2 * Math.sqrt(priceRatio);
            const fees = investment * 2 * feeEarnings;
            const lpTotalValue = lpValue + fees;
            const netProfit = lpTotalValue - investment * 2;
            
            document.getElementById('priceChange').textContent = `${priceChangePercent}%`;
            document.getElementById('ilPercentage').textContent = `${ilPercent}%`;
            document.getElementById('ilAmount').textContent = `$${ilAmount}`;
            document.getElementById('netProfit').textContent = `$${netProfit.toFixed(2)}`;
            
            document.getElementById('totalInvestment').textContent = `$${(investment * 2).toLocaleString()}`;
            document.getElementById('hodlValue').textContent = `$${hodlValue.toFixed(2)}`;
            document.getElementById('lpValueNoFees').textContent = `$${lpValue.toFixed(2)}`;
            document.getElementById('lpFees').textContent = `$${fees.toFixed(2)}`;
            document.getElementById('lpTotalValue').textContent = `$${lpTotalValue.toFixed(2)}`;
            document.getElementById('finalPnL').textContent = `${netProfit >= 0 ? '+' : ''}$${netProfit.toFixed(2)}`;
            
            drawILCurve();
            drawLPvsHODL();
        }
        
        function simulateRisk() {
            const scenario = document.getElementById('scenario').value;
            const timeSpan = parseInt(document.getElementById('timeSpan').value);
            const dailyVolume = parseFloat(document.getElementById('dailyVolume').value);
            
            let expectedAPY, maxIL, avgSlippage, riskAdjusted;
            
            switch(scenario) {
                case 'stable':
                    expectedAPY = dailyVolume * 0.0005 * 365; // 0.05% fee
                    maxIL = 0.5;
                    avgSlippage = 0.1;
                    break;
                case 'correlated':
                    expectedAPY = dailyVolume * 0.003 * 365; // 0.3% fee
                    maxIL = 5.7;
                    avgSlippage = 0.5;
                    break;
                case 'volatile':
                    expectedAPY = dailyVolume * 0.01 * 365; // 1% fee
                    maxIL = 25.5;
                    avgSlippage = 2.0;
                    break;
            }
            
            riskAdjusted = expectedAPY - maxIL;
            
            document.getElementById('expectedAPY').textContent = `${expectedAPY.toFixed(1)}%`;
            document.getElementById('maxILRisk').textContent = `${maxIL.toFixed(1)}%`;
            document.getElementById('avgSlippage').textContent = `${avgSlippage.toFixed(1)}%`;
            document.getElementById('riskAdjustedReturn').textContent = `${riskAdjusted.toFixed(1)}%`;
            
            drawRiskScenario();
        }
        
        function calculateReturns() {
            const investment = parseFloat(document.getElementById('calcInvestment').value);
            const tokenAPrice = parseFloat(document.getElementById('calcTokenAPrice').value);
            const tokenBPrice = parseFloat(document.getElementById('calcTokenBPrice').value);
            const priceChange = parseFloat(document.getElementById('calcPriceChange').value);
            const dailyVolume = parseFloat(document.getElementById('calcDailyVolume').value);
            const tvl = parseFloat(document.getElementById('calcTVL').value);
            const days = parseInt(document.getElementById('calcDays').value);
            const feeRate = parseFloat(document.getElementById('calcFeeRate').value);
            
            const poolShare = (investment / tvl) * 100;
            const dailyFees = dailyVolume * feeRate * (investment / tvl);
            const totalFees = dailyFees * days;
            
            const priceRatio = 1 + priceChange / 100;
            const il = investment * (2 * Math.sqrt(priceRatio) / (1 + priceRatio) - 1);
            const lpValue = investment * Math.sqrt(priceRatio) + totalFees;
            const hodlValue = investment * (1 + priceRatio) / 2 + investment / 2;
            const netReturn = lpValue - investment;
            const netReturnPercent = (netReturn / investment) * 100;
            
            document.getElementById('poolShare').textContent = `${poolShare.toFixed(4)}%`;
            document.getElementById('feeIncome').textContent = `$${totalFees.toFixed(2)}`;
            document.getElementById('calcIL').textContent = `$${il.toFixed(2)}`;
            document.getElementById('lpValue').textContent = `$${lpValue.toFixed(2)}`;
            document.getElementById('hodlValueCalc').textContent = `$${hodlValue.toFixed(2)}`;
            document.getElementById('netReturn').textContent = `${netReturn >= 0 ? '+' : ''}$${netReturn.toFixed(2)} (${netReturnPercent >= 0 ? '+' : ''}${netReturnPercent.toFixed(2)}%)`;
            
            drawReturnBreakdown();
        }
        
        // ÂàùÂßãÂåñ
        window.addEventListener('load', function() {
            drawSlippageCurve();
            drawSlippageFactors();
            calculateSlippage();
        });
    </script>
</body>
</html>